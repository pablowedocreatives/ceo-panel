<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sowper Command Center</title>
<style>
:root{--bg:#050505;--bg2:rgba(16,185,129,.03);--card:rgba(16,185,129,.06);--card-solid:#0a1210;--hover:rgba(16,185,129,.12);--accent:#10b981;--accent2:#34d399;--green:#10b981;--red:#ef4444;--orange:#f59e0b;--blue:#3b82f6;--cyan:#06b6d4;--pink:#ec4899;--purple:#a855f7;--yellow:#eab308;--text:#f0fdf4;--text2:#86efac;--muted:#4ade80;--border:rgba(16,185,129,.2);--glow:0 0 20px rgba(16,185,129,.15)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',-apple-system,system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;background-image:radial-gradient(ellipse at top,rgba(16,185,129,.08) 0%,transparent 50%),radial-gradient(ellipse at bottom right,rgba(16,185,129,.05) 0%,transparent 50%)}
button{font-family:inherit;cursor:pointer}input,select,textarea{font-family:inherit}
.app{display:flex;min-height:100vh}.sidebar{width:260px;background:linear-gradient(180deg,rgba(16,185,129,.08) 0%,rgba(16,185,129,.02) 100%);backdrop-filter:blur(20px);border-right:1px solid var(--border);position:fixed;height:100vh;display:flex;flex-direction:column;z-index:100}.main{margin-left:260px;flex:1}
.sidebar-header{padding:20px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px}.logo{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;font-size:16px;color:#000;box-shadow:var(--glow)}.brand{font-weight:700;font-size:16px;color:var(--text)}.brand span{color:var(--accent);display:block;font-size:11px;font-weight:500;letter-spacing:.5px}
.nav{padding:12px;flex:1;overflow-y:auto}.nav-section{margin-bottom:8px}.nav-label{font-size:10px;font-weight:600;color:var(--muted);text-transform:uppercase;padding:12px 12px 6px;letter-spacing:.5px}.nav-item{display:flex;align-items:center;gap:10px;padding:11px 14px;border-radius:10px;color:var(--text2);cursor:pointer;font-size:13px;font-weight:500;transition:all .2s}.nav-item:hover{background:var(--hover);color:var(--text)}.nav-item.active{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#000;font-weight:600;box-shadow:var(--glow)}.nav-badge{margin-left:auto;background:var(--accent);color:#000;font-size:10px;font-weight:700;padding:2px 8px;border-radius:10px}
.header{height:64px;background:linear-gradient(90deg,rgba(16,185,129,.06) 0%,transparent 100%);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 24px;position:sticky;top:0;z-index:50}.page-title{font-size:16px;font-weight:600;color:var(--text)}
.content{padding:24px}.page-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px;flex-wrap:wrap;gap:16px}.page-header h1{font-size:28px;font-weight:700;background:linear-gradient(135deg,var(--text),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.page-header p{color:var(--text2);font-size:13px;margin-top:4px}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 18px;border-radius:10px;font-size:13px;font-weight:600;border:none;transition:all .2s}.btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#000;box-shadow:var(--glow)}.btn-primary:hover{transform:translateY(-1px);box-shadow:0 0 30px rgba(16,185,129,.3)}.btn-secondary{background:var(--card);color:var(--text);border:1px solid var(--border)}.btn-secondary:hover{background:var(--hover);border-color:var(--accent)}.btn-danger{background:rgba(239,68,68,.2);color:var(--red);border:1px solid rgba(239,68,68,.3)}.btn-danger:hover{background:rgba(239,68,68,.3)}.btn-sm{padding:7px 14px;font-size:12px}
.grid{display:grid;gap:20px}.g4{grid-template-columns:repeat(4,1fr)}.g3{grid-template-columns:repeat(3,1fr)}.g2{grid-template-columns:repeat(2,1fr)}
.card{background:linear-gradient(135deg,var(--card) 0%,rgba(16,185,129,.02) 100%);backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:16px;padding:20px;transition:all .3s}.card:hover{border-color:rgba(16,185,129,.4);box-shadow:var(--glow)}.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.card-title{font-size:14px;font-weight:600;color:var(--text)}.card-link{font-size:12px;color:var(--accent);cursor:pointer;font-weight:500}.card-link:hover{color:var(--accent2)}
.stat{background:linear-gradient(135deg,var(--card) 0%,rgba(16,185,129,.02) 100%);backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:16px;padding:20px;cursor:pointer;transition:all .3s}.stat:hover{transform:translateY(-2px);border-color:var(--accent);box-shadow:var(--glow)}.stat-icon{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;justify-content:center;margin-bottom:14px;font-size:22px}.stat-icon.green{background:rgba(16,185,129,.15);box-shadow:0 0 20px rgba(16,185,129,.1)}.stat-icon.orange{background:rgba(245,158,11,.15)}.stat-icon.blue{background:rgba(59,130,246,.15)}.stat-icon.yellow{background:rgba(234,179,8,.15)}.stat-icon.red{background:rgba(239,68,68,.15)}.stat-value{font-size:32px;font-weight:700;background:linear-gradient(135deg,var(--text),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.stat-label{font-size:12px;color:var(--text2);margin-top:4px;font-weight:500}
.form-group{margin-bottom:16px}.form-label{display:block;font-size:12px;font-weight:600;color:var(--text2);margin-bottom:6px}.form-input,.form-select,.form-textarea{width:100%;padding:12px 14px;background:rgba(16,185,129,.05);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:13px;transition:all .2s}.form-input:focus,.form-select:focus,.form-textarea:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(16,185,129,.1)}.form-textarea{min-height:100px;resize:vertical}.form-row{display:flex;gap:14px}.form-row .form-group{flex:1}.form-select{cursor:pointer}.form-select option{background:var(--card-solid);color:var(--text)}
.tag{display:inline-flex;padding:5px 12px;border-radius:8px;font-size:11px;font-weight:600}
.list-item{display:flex;align-items:center;gap:14px;padding:14px;background:rgba(16,185,129,.04);border:1px solid transparent;border-radius:12px;margin-bottom:10px;cursor:pointer;transition:all .2s}.list-item:hover{background:var(--hover);border-color:var(--border)}.item-content{flex:1;min-width:0}.item-title{font-size:13px;font-weight:500;margin-bottom:4px;color:var(--text)}.item-meta{font-size:11px;color:var(--muted);display:flex;gap:12px}
.avatar{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:600}
.empty{text-align:center;padding:40px;color:var(--muted);font-size:13px}
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.8);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;z-index:1000;padding:20px}.modal-bg.active{display:flex}.modal{background:linear-gradient(135deg,var(--card-solid) 0%,#0d1915 100%);border:1px solid var(--border);border-radius:20px;width:100%;max-width:500px;max-height:90vh;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 25px 50px rgba(0,0,0,.5),var(--glow)}.modal.lg{max-width:600px}.modal-header{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid var(--border)}.modal-title{font-size:18px;font-weight:600;color:var(--text)}.modal-close{width:36px;height:36px;border-radius:10px;background:var(--card);border:1px solid var(--border);color:var(--text2);cursor:pointer;font-size:20px;transition:all .2s}.modal-close:hover{background:var(--hover);color:var(--text);border-color:var(--accent)}.modal-body{padding:24px;overflow-y:auto;flex:1}.modal-footer{display:flex;justify-content:flex-end;gap:12px;padding:20px 24px;border-top:1px solid var(--border);background:rgba(16,185,129,.02)}
.toast-box{position:fixed;bottom:24px;right:24px;z-index:2000}.toast{background:var(--card-solid);border:1px solid var(--border);border-radius:12px;padding:14px 18px;font-size:13px;margin-top:10px;box-shadow:0 10px 40px rgba(0,0,0,.3)}.toast.success{border-left:3px solid var(--green)}.toast.error{border-left:3px solid var(--red)}
.progress-bar{height:6px;background:rgba(16,185,129,.1);border-radius:3px;overflow:hidden}.progress-fill{height:100%;border-radius:3px}
.platform-icon{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700}.platform-google{background:linear-gradient(135deg,#4285f4,#34a853);color:#fff}.platform-meta{background:linear-gradient(135deg,#0081fb,#00c6ff);color:#fff}.platform-tiktok{background:linear-gradient(135deg,#000,#25f4ee);color:#fff}.platform-linkedin{background:linear-gradient(135deg,#0a66c2,#0077b5);color:#fff}.platform-other{background:var(--muted);color:#fff}
.pipeline{display:flex;gap:16px;overflow-x:auto;padding-bottom:16px}.pipeline-col{min-width:280px;width:280px;background:linear-gradient(180deg,var(--card) 0%,transparent 100%);border:1px solid var(--border);border-radius:16px;display:flex;flex-direction:column;max-height:calc(100vh - 240px)}.pipeline-header{padding:16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}.pipeline-title{font-size:13px;font-weight:600;display:flex;align-items:center;gap:8px}.pipeline-count{background:var(--card);padding:4px 10px;border-radius:8px;font-size:11px;font-weight:600}.pipeline-body{padding:10px;flex:1;overflow-y:auto;min-height:100px}.pipeline-card{background:var(--card-solid);border:1px solid var(--border);border-radius:12px;padding:14px;margin-bottom:10px;cursor:pointer;transition:all .2s}.pipeline-card:hover{border-color:var(--accent);transform:translateY(-1px)}
.detail-header{background:linear-gradient(135deg,var(--card) 0%,rgba(16,185,129,.02) 100%);border:1px solid var(--border);border-radius:20px;padding:28px;margin-bottom:24px}.detail-title{font-size:26px;font-weight:700;margin-bottom:6px;background:linear-gradient(135deg,var(--text),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.detail-subtitle{color:var(--text2);font-size:14px}.detail-stats{display:flex;gap:32px;margin-top:20px;flex-wrap:wrap}.detail-stat{text-align:center}.detail-stat-value{font-size:24px;font-weight:700;color:var(--text)}.detail-stat-label{font-size:11px;color:var(--muted);margin-top:2px}
.back-btn{display:inline-flex;align-items:center;gap:8px;color:var(--text2);font-size:13px;cursor:pointer;margin-bottom:20px;font-weight:500;transition:color .2s}.back-btn:hover{color:var(--accent)}
.table{width:100%;border-collapse:collapse;font-size:13px}.table th{text-align:left;padding:14px;color:var(--text2);font-weight:600;border-bottom:1px solid var(--border);font-size:11px;text-transform:uppercase;letter-spacing:.5px}.table td{padding:14px;border-bottom:1px solid rgba(16,185,129,.1)}.table tr:hover td{background:var(--hover)}
.account-card{background:var(--card);border-radius:12px;padding:16px;margin-bottom:12px;cursor:pointer;border-left:3px solid var(--accent);transition:all .2s}.account-card:hover{background:var(--hover)}.account-card.google{border-left-color:#4285f4}.account-card.meta{border-left-color:#0081fb}.account-card.tiktok{border-left-color:#ff0050}.account-card.linkedin{border-left-color:#0a66c2}
.mobile-header{display:none;position:fixed;top:0;left:0;right:0;height:60px;background:linear-gradient(90deg,rgba(16,185,129,.08) 0%,var(--bg) 100%);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);z-index:90;padding:0 16px;align-items:center;gap:14px}.menu-btn{width:44px;height:44px;background:var(--card);border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:20px}
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(4px);z-index:95}.overlay.active{display:block}
@media(max-width:768px){.sidebar{transform:translateX(-100%);transition:transform .3s;width:280px}.sidebar.open{transform:translateX(0)}.main{margin-left:0;padding-top:60px}.header{display:none}.mobile-header{display:flex}.g4,.g3{grid-template-columns:repeat(2,1fr)}.g2{grid-template-columns:1fr}.pipeline{flex-direction:column}.pipeline-col{width:100%;min-width:100%;max-height:none}.content{padding:16px}.page-header h1{font-size:22px}}
.mb-1{margin-bottom:10px}.mb-2{margin-bottom:20px}
</style>
</head>
<body>
<div id="app"></div>
<script>
const PLATFORMS=[{id:'google',name:'Google Ads',icon:'G',color:'#4285f4'},{id:'meta',name:'Meta Ads',icon:'M',color:'#0081fb'},{id:'tiktok',name:'TikTok Ads',icon:'T',color:'#ff0050'},{id:'linkedin',name:'LinkedIn Ads',icon:'in',color:'#0a66c2'},{id:'other',name:'Otro',icon:'?',color:'#71717a'}];
const ACCOUNT_STATUS=[{id:'active',name:'Activa',color:'var(--green)'},{id:'onboarding',name:'Onboarding',color:'var(--blue)'},{id:'paused',name:'Pausada',color:'var(--orange)'},{id:'cancelled',name:'Baja',color:'var(--red)'}];
const SENTIMENTS=[{id:'happy',emoji:'ğŸ˜Š',label:'Contento'},{id:'neutral',emoji:'ğŸ˜',label:'Neutral'},{id:'unhappy',emoji:'ğŸ˜Ÿ',label:'Descontento'}];
const LEAD_STAGES=[{id:'lead',name:'Lead',color:'var(--muted)'},{id:'contacted',name:'Contactado',color:'var(--blue)'},{id:'meeting',name:'ReuniÃ³n',color:'var(--cyan)'},{id:'proposal',name:'Propuesta',color:'var(--purple)'},{id:'negotiation',name:'NegociaciÃ³n',color:'var(--orange)'},{id:'won',name:'Ganado',color:'var(--green)'},{id:'lost',name:'Perdido',color:'var(--red)'}];
const FEE=350,CAP=35;

const DB={
key:â€˜sowper_v3â€™,data:null,
defaults:{
company:{name:â€˜Sowperâ€™},
managers:[{id:â€˜m1â€™,name:â€˜MarÃ­a GarcÃ­aâ€™,initials:â€˜MGâ€™,color:â€˜linear-gradient(135deg,#f97316,#eab308)â€™,salary:2200,active:true},{id:â€˜m2â€™,name:â€˜Carlos LÃ³pezâ€™,initials:â€˜CLâ€™,color:â€˜linear-gradient(135deg,#3b82f6,#06b6d4)â€™,salary:2200,active:true}],
comerciales:[{id:â€˜com1â€™,name:â€˜Ana Ruizâ€™,initials:â€˜ARâ€™,color:â€˜linear-gradient(135deg,#ec4899,#f97316)â€™,salary:1800,active:true}],
referrers:[{id:â€˜ref1â€™,name:â€˜Pedro MartÃ­nâ€™,company:â€˜Agencia XYZâ€™,commission:10,notes:â€™â€™}],
clients:[{id:â€˜cl1â€™,name:â€˜Enter Propertiesâ€™,contact:â€˜Juan PÃ©rezâ€™,email:â€˜juan@enter.comâ€™,phone:â€˜666111222â€™,sentiment:â€˜happyâ€™,notes:â€˜Cliente premiumâ€™,since:â€˜2022-06â€™},{id:â€˜cl2â€™,name:â€˜Aventura Amazoniaâ€™,contact:â€˜Laura Sanzâ€™,email:â€˜laura@aventura.comâ€™,phone:â€˜666333444â€™,sentiment:â€˜neutralâ€™,notes:â€™â€™,since:â€˜2023-03â€™},{id:â€˜cl3â€™,name:â€˜TODOCAMAâ€™,contact:â€˜Pedro Ruizâ€™,email:â€˜pedro@todocama.comâ€™,phone:â€˜666555666â€™,sentiment:â€˜happyâ€™,notes:â€™â€™,since:â€˜2023-09â€™}],
accounts:[{id:â€˜a1â€™,clientId:â€˜cl1â€™,platform:â€˜googleâ€™,status:â€˜activeâ€™,managerId:â€˜m1â€™,fee:350,investment:2000,metrics:[],calendarActions:[],commissions:[]},{id:â€˜a2â€™,clientId:â€˜cl1â€™,platform:â€˜metaâ€™,status:â€˜activeâ€™,managerId:â€˜m1â€™,fee:350,investment:1500,metrics:[],calendarActions:[],commissions:[]},{id:â€˜a3â€™,clientId:â€˜cl2â€™,platform:â€˜googleâ€™,status:â€˜activeâ€™,managerId:â€˜m2â€™,fee:350,investment:3000,metrics:[],calendarActions:[],commissions:[]},{id:â€˜a4â€™,clientId:â€˜cl3â€™,platform:â€˜metaâ€™,status:â€˜onboardingâ€™,managerId:â€˜m2â€™,fee:350,investment:800,metrics:[],calendarActions:[],commissions:[]}],
leads:[{id:â€˜ld1â€™,name:â€˜Restaurante Marinaâ€™,contact:â€˜Luis Torresâ€™,email:â€™â€™,phone:â€™â€™,accounts:2,mrr:700,stage:â€˜proposalâ€™,source:â€˜webâ€™,comercialId:â€˜com1â€™,referrerId:null,notes:â€™â€™,created:â€˜2025-01-05â€™},{id:â€˜ld2â€™,name:â€˜Gimnasio FitLifeâ€™,contact:â€˜Sara Vegaâ€™,email:â€™â€™,phone:â€™â€™,accounts:3,mrr:1050,stage:â€˜negotiationâ€™,source:â€˜referralâ€™,comercialId:â€˜com1â€™,referrerId:â€˜ref1â€™,notes:â€™â€™,created:â€˜2025-01-03â€™}],
tasks:[{id:â€˜t1â€™,title:â€˜Revisar campaÃ±as Enterâ€™,accountId:â€˜a1â€™,managerId:â€˜m1â€™,status:â€˜pendingâ€™,due:â€˜2025-01-10â€™,priority:â€˜highâ€™},{id:â€˜t2â€™,title:â€˜Setup TODOCAMAâ€™,accountId:â€˜a4â€™,managerId:â€˜m2â€™,status:â€˜pendingâ€™,due:â€˜2025-01-08â€™,priority:â€˜highâ€™}],
expenses:[{id:â€˜e1â€™,category:â€˜payrollâ€™,name:â€˜MarÃ­a GarcÃ­aâ€™,amount:2200,monthly:true},{id:â€˜e2â€™,category:â€˜payrollâ€™,name:â€˜Carlos LÃ³pezâ€™,amount:2200,monthly:true},{id:â€˜e3â€™,category:â€˜payrollâ€™,name:â€˜Ana Ruizâ€™,amount:1800,monthly:true},{id:â€˜e4â€™,category:â€˜toolsâ€™,name:â€˜Herramientasâ€™,amount:200,monthly:true}],
objectives:[{id:â€˜o1â€™,title:â€˜140 cuentasâ€™,area:â€˜growthâ€™,target:140,current:4,unit:â€˜cuentasâ€™},{id:â€˜o2â€™,title:â€˜4 managersâ€™,area:â€˜teamâ€™,target:4,current:2,unit:â€˜managersâ€™},{id:â€˜o3â€™,title:â€˜MRR 49Kâ€™,area:â€˜revenueâ€™,target:49000,current:1400,unit:â€˜EURâ€™}],
decisions:[{id:â€˜d1â€™,title:â€˜Contratar tercer managerâ€™,context:â€™â€™,deadline:â€˜2025-02-01â€™,decided:false}],
opportunities:[{id:â€˜op1â€™,title:â€˜Servicio creatividadesâ€™,desc:â€˜Upsell de diseÃ±oâ€™,potential:5000,status:â€˜ideaâ€™}],
projects:[{id:â€˜pr1â€™,title:â€˜Dashboard clientesâ€™,desc:â€˜Portal mÃ©tricasâ€™,progress:20,status:â€˜activeâ€™}],
actions:[],inbox:[],scenario:{newAccMonth:5,churn:3,avgFee:350}
},
init:function(){var s=localStorage.getItem(this.key);this.data=s?JSON.parse(s):JSON.parse(JSON.stringify(this.defaults));this.save();},
save:function(){localStorage.setItem(this.key,JSON.stringify(this.data));},
reset:function(){this.data=JSON.parse(JSON.stringify(this.defaults));this.save();},
add:function(t,item){item.id=t[0]+Date.now();this.data[t].push(item);this.save();return item;},
update:function(t,id,d){var i=this.data[t].findIndex(function(x){return x.id===id;});if(i>-1){Object.assign(this.data[t][i],d);this.save();}},
del:function(t,id){this.data[t]=this.data[t].filter(function(x){return x.id!==id;});this.save();},
get:function(t,id){return this.data[t].find(function(x){return x.id===id;});},
getClient:function(id){return this.data.clients.find(function(c){return c.id===id;});},
getManager:function(id){return this.data.managers.find(function(m){return m.id===id;});},
getComercial:function(id){return this.data.comerciales.find(function(c){return c.id===id;});},
getReferrer:function(id){return this.data.referrers.find(function(r){return r.id===id;});},
accountsByClient:function(cid){return this.data.accounts.filter(function(a){return a.clientId===cid;});},
accountsByManager:function(mid){return this.data.accounts.filter(function(a){return a.managerId===mid;});},
activeAccounts:function(){return this.data.accounts.filter(function(a){return a.status===â€˜activeâ€™||a.status===â€˜onboardingâ€™;});},
stats:function(){
var acc=this.activeAccounts();
var mrr=acc.reduce(function(s,a){return s+(a.fee||FEE);},0);
var exp=this.data.expenses.filter(function(e){return e.monthly;}).reduce(function(s,e){return s+e.amount;},0);
var leads=this.data.leads.filter(function(l){return l.stage!==â€˜wonâ€™&&l.stage!==â€˜lostâ€™;});
return{accounts:acc.length,mrr:mrr,expenses:exp,margin:mrr-exp,clients:this.data.clients.length,leads:leads.length,pipelineMRR:leads.reduce(function(s,l){return s+(l.mrr||0);},0),pendingDec:this.data.decisions.filter(function(d){return!d.decided;}).length,pendingTasks:this.data.tasks.filter(function(t){return t.status!==â€˜doneâ€™;}).length};
}
};

var U={
money:function(n){return new Intl.NumberFormat(â€˜es-ESâ€™,{style:â€˜currencyâ€™,currency:â€˜EURâ€™,maximumFractionDigits:0}).format(n||0);},
pct:function(v,t){return t?Math.round((v/t)*100):0;},
date:function(d){if(!d)returnâ€™-â€™;return new Date(d).toLocaleDateString(â€˜es-ESâ€™,{day:â€˜numericâ€™,month:â€˜shortâ€™});},
today:function(){return new Date().toISOString().split(â€˜Tâ€™)[0];},
progColor:function(p){return p>=75?â€˜var(â€“green)â€™:p>=50?â€˜var(â€“blue)â€™:p>=25?â€˜var(â€“orange)â€™:â€˜var(â€“red)â€™;}
};

var UI={
toast:function(m,t){t=t||â€˜successâ€™;var c=document.getElementById(â€˜toastsâ€™);var d=document.createElement(â€˜divâ€™);d.className=â€˜toast â€˜+t;d.textContent=m;c.appendChild(d);setTimeout(function(){d.remove();},3000);},
modal:function(title,body,footer,size){footer=footer||â€™â€™;size=size||â€™â€™;document.getElementById(â€˜modalsâ€™).innerHTML=â€™<div class="modal-bg active" onclick="if(event.target===this)UI.closeModal()"><div class="modal '+size+'"><div class="modal-header"><div class="modal-title">â€™+title+â€™</div><button class="modal-close" onclick="UI.closeModal()">Ã—</button></div><div class="modal-body">â€™+body+â€™</div>â€™+(footer?â€™<div class="modal-footer">â€™+footer+â€™</div>â€™:â€™â€™)+â€™</div></div>â€™;},
closeModal:function(){document.getElementById(â€˜modalsâ€™).innerHTML=â€™â€™;},
confirm:function(m,fn){this.modal(â€˜Confirmarâ€™,â€™<p>â€™+m+â€™</p>â€™,â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-danger" onclick="UI.closeModal();'+fn+'">Confirmar</button>â€™);}
};

var page=â€˜dashboardâ€™,detail=null;
function nav(p){page=p;detail=null;document.querySelectorAll(â€™.nav-itemâ€™).forEach(function(i){i.classList.toggle(â€˜activeâ€™,i.dataset.page===p);});render();}
function openDetail(t,id){detail={type:t,id:id};render();}
function closeDetail(){detail=null;render();}
function render(){
var c=document.getElementById(â€˜pageContentâ€™);
if(detail){
if(detail.type===â€˜clientâ€™)c.innerHTML=pgClientDetail(detail.id);
else if(detail.type===â€˜accountâ€™)c.innerHTML=pgAccountDetail(detail.id);
else c.innerHTML=pgByPage();
}else{c.innerHTML=pgByPage();}
document.getElementById(â€˜pageTitleâ€™).textContent=getTitleByPage();
updateBadges();
}
function getTitleByPage(){var titles={dashboard:â€˜Dashboardâ€™,clients:â€˜Clientesâ€™,accounts:â€˜Cuentasâ€™,pipeline:â€˜Pipelineâ€™,managers:â€˜Managersâ€™,comerciales:â€˜Comercialesâ€™,referrers:â€˜Referidoresâ€™,finance:â€˜Finanzasâ€™,tasks:â€˜Tareasâ€™,objectives:â€˜Objetivosâ€™,decisions:â€˜Decisionesâ€™,opportunities:â€˜Oportunidadesâ€™,projects:â€˜Proyectosâ€™,inbox:â€˜Inboxâ€™,settings:â€˜Configâ€™};return titles[page]||â€˜Dashboardâ€™;}
function updateBadges(){var s=DB.stats();var el=function(id){return document.getElementById(id);};if(el(â€˜leadsBadgeâ€™))el(â€˜leadsBadgeâ€™).textContent=s.leads;if(el(â€˜decBadgeâ€™))el(â€˜decBadgeâ€™).textContent=s.pendingDec;if(el(â€˜taskBadgeâ€™))el(â€˜taskBadgeâ€™).textContent=s.pendingTasks;if(el(â€˜inboxBadgeâ€™))el(â€˜inboxBadgeâ€™).textContent=DB.data.inbox.length;}
function pgByPage(){var pages={dashboard:pgDash,clients:pgClients,accounts:pgAccounts,pipeline:pgPipeline,managers:pgManagers,comerciales:pgComerciales,referrers:pgReferrers,finance:pgFinance,tasks:pgTasks,objectives:pgObjectives,decisions:pgDecisions,opportunities:pgOpportunities,projects:pgProjects,inbox:pgInbox,settings:pgSettings};return(pages[page]||pgDash)();}

function pgDash(){
var s=DB.stats();
var dec=DB.data.decisions.filter(function(d){return!d.decided;}).slice(0,3);
var tasks=DB.data.tasks.filter(function(t){return t.status!==â€˜doneâ€™&&t.priority===â€˜highâ€™;}).slice(0,4);
var html=â€™<div class="page-header"><div><h1>ğŸš€ Dashboard</h1><p>Centro de control Sowper</p></div><div><button class="btn btn-primary" onclick="showAccountModal()">+ Cuenta</button></div></div>â€™;
html+=â€™<div class="grid g4 mb-2">â€™;
html+=â€™<div class="stat" onclick="nav(\'accounts\')"><div class="stat-icon orange">ğŸ“Š</div><div class="stat-value">â€™+s.accounts+â€™</div><div class="stat-label">Cuentas</div></div>â€™;
html+=â€™<div class="stat" onclick="nav(\'finance\')"><div class="stat-icon green">ğŸ’°</div><div class="stat-value">â€™+U.money(s.mrr)+â€™</div><div class="stat-label">MRR</div></div>â€™;
html+=â€™<div class="stat" onclick="nav(\'finance\')"><div class="stat-icon blue">ğŸ“ˆ</div><div class="stat-value">â€™+U.money(s.margin)+â€™</div><div class="stat-label">Margen</div></div>â€™;
html+=â€™<div class="stat" onclick="nav(\'pipeline\')"><div class="stat-icon yellow">ğŸ¯</div><div class="stat-value">â€™+s.leads+â€™</div><div class="stat-label">Pipeline</div></div>â€™;
html+=â€™</div>â€™;
html+=â€™<div class="grid g2 mb-2">â€™;
html+=â€™<div class="card"><div class="card-header"><div class="card-title">âš¡ Decisiones</div><span class="card-link" onclick="nav(\'decisions\')">Ver â†’</span></div>â€™;
if(dec.length){dec.forEach(function(d){html+=â€™<div class="list-item" onclick="showDecisionModal(DB.get(\'decisions\',\''+d.id+'\'))"><div class="item-content"><div class="item-title">â€™+d.title+â€™</div>â€™+(d.deadline?â€™<div class="item-meta"><span>ğŸ“… â€˜+U.date(d.deadline)+â€™</span></div>â€™:â€™â€™)+â€™</div></div>â€™;});}else{html+=â€™<div class="empty">Sin decisiones ğŸ‰</div>â€™;}
html+=â€™</div>â€™;
html+=â€™<div class="card"><div class="card-header"><div class="card-title">ğŸ”¥ Tareas urgentes</div><span class="card-link" onclick="nav(\'tasks\')">Ver â†’</span></div>â€™;
if(tasks.length){tasks.forEach(function(t){var acc=t.accountId?DB.get(â€˜accountsâ€™,t.accountId):null;var cl=acc?DB.getClient(acc.clientId):null;html+=â€™<div class="list-item" onclick="showTaskModal(DB.get(\'tasks\',\''+t.id+'\'))"><div class="item-content"><div class="item-title">â€™+t.title+â€™</div><div class="item-meta">â€™+(cl?â€™<span>â€™+cl.name+â€™</span>â€™:â€™â€™)+(t.due?â€™<span>ğŸ“… â€˜+U.date(t.due)+â€™</span>â€™:â€™â€™)+â€™</div></div></div>â€™;});}else{html+=â€™<div class="empty">Sin tareas urgentes ğŸ‰</div>â€™;}
html+=â€™</div></div>â€™;
html+=â€™<div class="grid g2">â€™;
var recentLeads=DB.data.leads.filter(function(l){return l.stage!==â€˜wonâ€™&&l.stage!==â€˜lostâ€™;}).slice(0,4);
html+=â€™<div class="card"><div class="card-header"><div class="card-title">ğŸ¯ Pipeline</div><span class="card-link" onclick="nav(\'pipeline\')">Ver â†’</span></div>â€™;
if(recentLeads.length){recentLeads.forEach(function(l){var st=LEAD_STAGES.find(function(s){return s.id===l.stage;});html+=â€™<div class="list-item" onclick="showLeadModal(DB.get(\'leads\',\''+l.id+'\'))"><div class="item-content"><div class="item-title">â€™+l.name+â€™</div><div class="item-meta"><span>â€™+l.accounts+â€™ cuentas</span><span>â€™+U.money(l.mrr)+â€™/mes</span></div></div><span class="tag" style="background:'+st.color+'22;color:'+st.color+'">â€™+st.name+â€™</span></div>â€™;});}else{html+=â€™<div class="empty">Sin leads</div>â€™;}
html+=â€™</div>â€™;
html+=â€™<div class="card"><div class="card-header"><div class="card-title">ğŸ“ˆ Objetivos</div><span class="card-link" onclick="nav(\'objectives\')">Ver â†’</span></div>â€™;
DB.data.objectives.slice(0,3).forEach(function(o){var p=U.pct(o.current,o.target);html+=â€™<div style="margin-bottom:12px"><div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:4px"><span>â€™+o.title+â€™</span><span style="color:'+U.progColor(p)+'">â€™+p+â€™%</span></div><div class="progress-bar"><div class="progress-fill" style="width:'+p+'%;background:'+U.progColor(p)+'"></div></div></div>â€™;});
html+=â€™</div></div>â€™;
return html;
}

function pgClients(){
var clients=DB.data.clients;
var html=â€™<div class="page-header"><div><h1>ğŸ‘¥ Clientes</h1><p>â€™+clients.length+â€™ clientes</p></div><div><button class="btn btn-primary" onclick="showClientModal()">+ Cliente</button></div></div>â€™;
html+=â€™<div class="grid g3">â€™;
clients.forEach(function(c){
var acc=DB.accountsByClient(c.id).filter(function(a){return a.status===â€˜activeâ€™||a.status===â€˜onboardingâ€™;});
var mrr=acc.reduce(function(s,a){return s+(a.fee||FEE);},0);
var sent=SENTIMENTS.find(function(s){return s.id===c.sentiment;})||{emoji:â€˜ğŸ˜â€™};
html+=â€™<div class="card" onclick="openDetail(\'client\',\''+c.id+'\')" style="cursor:pointer">â€™;
html+=â€™<div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px"><div class="card-title">â€™+c.name+â€™</div><span style="font-size:24px">â€™+sent.emoji+â€™</span></div>â€™;
html+=â€™<div style="font-size:12px;color:var(--text2);margin-bottom:10px">â€™+(c.contact||â€™-â€™)+â€™</div>â€™;
html+=â€™<div style="display:flex;gap:4px;margin-bottom:10px">â€™;
acc.forEach(function(a){var pl=PLATFORMS.find(function(p){return p.id===a.platform;});html+=â€™<div class="platform-icon platform-'+a.platform+'" style="width:22px;height:22px;font-size:10px">â€™+pl.icon+â€™</div>â€™;});
html+=â€™</div>â€™;
html+=â€™<div style="display:flex;justify-content:space-between;font-size:12px"><span>â€™+acc.length+â€™ cuentas</span><span style="color:var(--green);font-weight:600">â€™+U.money(mrr)+â€™/mes</span></div>â€™;
html+=â€™</div>â€™;
});
html+=â€™</div>â€™;
return html;
}

function pgClientDetail(id){
var c=DB.getClient(id);if(!c)returnâ€™<div class="empty">No encontrado</div>â€™;
var acc=DB.accountsByClient(id);
var active=acc.filter(function(a){return a.status===â€˜activeâ€™||a.status===â€˜onboardingâ€™;});
var mrr=active.reduce(function(s,a){return s+(a.fee||FEE);},0);
var actions=DB.data.actions?DB.data.actions.filter(function(a){return a.clientId===id;}):[];
var sent=SENTIMENTS.find(function(s){return s.id===c.sentiment;})||{emoji:â€˜ğŸ˜â€™};
var html=â€™<div class="back-btn" onclick="closeDetail()">â† Volver</div>â€™;
html+=â€™<div class="detail-header"><div style="display:flex;justify-content:space-between;align-items:start"><div><div class="detail-title">â€™+c.name+â€™</div><div class="detail-subtitle">â€™+(c.contact||â€™â€™)+(c.email?â€™ Â· â€˜+c.email:â€™â€™)+â€™</div></div><button class="btn btn-secondary btn-sm" onclick="showClientModal(DB.getClient(\''+id+'\'))">âœï¸ Editar</button></div>â€™;
html+=â€™<div class="detail-stats"><div class="detail-stat"><div class="detail-stat-value">â€™+active.length+â€™</div><div class="detail-stat-label">Cuentas</div></div><div class="detail-stat"><div class="detail-stat-value" style="color:var(--green)">â€™+U.money(mrr)+â€™</div><div class="detail-stat-label">MRR</div></div><div class="detail-stat"><div class="detail-stat-value">â€™+(c.since||â€™-â€™)+â€™</div><div class="detail-stat-label">Desde</div></div><div class="detail-stat" onclick="showSentimentModal(\''+id+'\')" style="cursor:pointer"><div style="font-size:32px">â€™+sent.emoji+â€™</div><div class="detail-stat-label">Sentimiento</div></div></div></div>â€™;
html+=â€™<div class="grid g2 mb-2"><div class="card"><div class="card-header"><div class="card-title">ğŸ“Š Cuentas</div><button class="btn btn-sm btn-primary" onclick="showAccountModal(null,\''+id+'\')">+</button></div>â€™;
if(acc.length){acc.forEach(function(a){html+=accountCard(a);});}else{html+=â€™<div class="empty">Sin cuentas</div>â€™;}
html+=â€™</div><div class="card"><div class="card-header"><div class="card-title">ğŸ“ Notas</div><button class="btn btn-sm btn-secondary" onclick="editClientNotes(\''+id+'\')">Editar</button></div><div style="font-size:13px;color:var(--text2);white-space:pre-wrap">â€™+(c.notes||â€˜Sin notasâ€™)+â€™</div></div></div>â€™;
html+=â€™<div class="card"><div class="card-header"><div class="card-title">ğŸ“‹ Historial</div><button class="btn btn-sm btn-primary" onclick="showActionModal(\''+id+'\')">+ AcciÃ³n</button></div>â€™;
if(actions.length){actions.sort(function(a,b){return new Date(b.date)-new Date(a.date);}).slice(0,10).forEach(function(a){html+=â€™<div class="list-item"><div class="item-content"><div class="item-title">â€™+a.text+â€™</div><div class="item-meta"><span>â€™+U.date(a.date)+â€™</span></div></div></div>â€™;});}else{html+=â€™<div class="empty">Sin acciones</div>â€™;}
html+=â€™</div>â€™;
return html;
}

function accountCard(a){
var cl=DB.getClient(a.clientId);var mg=DB.getManager(a.managerId);var pl=PLATFORMS.find(function(p){return p.id===a.platform;});var st=ACCOUNT_STATUS.find(function(s){return s.id===a.status;});
var html=â€™<div class="account-card '+a.platform+'" onclick="openDetail(\'account\',\''+a.id+'\');event.stopPropagation()">â€™;
html+=â€™<div style="display:flex;justify-content:space-between;align-items:start"><div style="display:flex;align-items:center;gap:10px"><div class="platform-icon platform-'+a.platform+'">â€™+pl.icon+â€™</div><div><div style="font-weight:600;font-size:13px">â€™+pl.name+â€™</div><div style="font-size:11px;color:var(--text2)">ğŸ‘¤ â€˜+(mg?mg.name:â€™-â€™)+â€™</div></div></div><span class="tag" style="background:'+st.color+'22;color:'+st.color+'">â€™+st.name+â€™</span></div>â€™;
html+=â€™<div style="display:flex;justify-content:space-between;margin-top:10px;font-size:12px;color:var(--text2)"><span>Fee: â€˜+U.money(a.fee)+â€™</span><span>Inv: â€˜+U.money(a.investment)+â€™</span></div></div>â€™;
return html;
}
function pgAccounts(){
var acc=DB.data.accounts;var byP={};PLATFORMS.forEach(function(p){byP[p.id]=acc.filter(function(a){return a.platform===p.id;});});
var html=â€™<div class="page-header"><div><h1>ğŸ“Š Cuentas</h1><p>â€™+acc.length+â€™ totales</p></div><div><button class="btn btn-primary" onclick="showAccountModal()">+ Cuenta</button></div></div>â€™;
html+=â€™<div class="grid g4 mb-2">â€™;
PLATFORMS.forEach(function(p){var n=byP[p.id].filter(function(a){return a.status===â€˜activeâ€™;}).length;html+=â€™<div class="stat"><div class="stat-icon" style="background:'+p.color+'22"><span style="color:'+p.color+'">â€™+p.icon+â€™</span></div><div class="stat-value">â€™+n+â€™</div><div class="stat-label">â€™+p.name+â€™</div></div>â€™;});
html+=â€™</div><div class="grid g2">â€™;
PLATFORMS.forEach(function(p){if(byP[p.id].length>0){html+=â€™<div class="card"><div class="card-title mb-1" style="color:'+p.color+'">â€™+p.icon+â€™ â€˜+p.name+â€™ (â€™+byP[p.id].length+â€™)</div>â€™;byP[p.id].forEach(function(a){html+=accountCard(a);});html+=â€™</div>â€™;}});
html+=â€™</div>â€™;return html;
}

function pgAccountDetail(id){
var a=DB.get(â€˜accountsâ€™,id);if(!a)returnâ€™<div class="empty">No encontrado</div>â€™;
var cl=DB.getClient(a.clientId);var mg=DB.getManager(a.managerId);var pl=PLATFORMS.find(function(p){return p.id===a.platform;});
var com=a.commissions||[];var met=a.metrics||[];var cal=a.calendarActions||[];
var html=â€™<div class="back-btn" onclick="closeDetail()">â† Volver</div>â€™;
html+=â€™<div class="detail-header"><div style="display:flex;justify-content:space-between;align-items:start"><div style="display:flex;align-items:center;gap:16px"><div class="platform-icon platform-'+a.platform+'" style="width:56px;height:56px;font-size:24px">â€™+pl.icon+â€™</div><div><div class="detail-title">â€™+(cl?cl.name:â€™-â€™)+â€™ - â€˜+pl.name+â€™</div><div class="detail-subtitle">Manager: â€˜+(mg?mg.name:â€™-â€™)+â€™</div></div></div><button class="btn btn-secondary btn-sm" onclick="showAccountModal(DB.get(\'accounts\',\''+id+'\'))">âœï¸</button></div>â€™;
html+=â€™<div class="detail-stats"><div class="detail-stat"><div class="detail-stat-value" style="color:var(--green)">â€™+U.money(a.fee)+â€™</div><div class="detail-stat-label">Fee</div></div><div class="detail-stat"><div class="detail-stat-value">â€™+U.money(a.investment)+â€™</div><div class="detail-stat-label">InversiÃ³n</div></div><div class="detail-stat"><div class="detail-stat-value">â€™+(met[0]?met[0].leads:â€™-â€™)+â€™</div><div class="detail-stat-label">Leads</div></div><div class="detail-stat"><div class="detail-stat-value">â€™+(met[0]?U.money(met[0].cpl):â€™-â€™)+â€™</div><div class="detail-stat-label">CPL</div></div></div></div>â€™;
html+=â€™<div class="grid g2 mb-2"><div class="card"><div class="card-header"><div class="card-title">ğŸ“… Calendario</div><button class="btn btn-sm btn-primary" onclick="showCalActionModal(\''+id+'\')">+</button></div>â€™;
if(cal.length){cal.forEach(function(c){var types={revision:â€˜ğŸ“‹ RevisiÃ³nâ€™,report:â€˜ğŸ“Š Informeâ€™,optimization:â€˜âš¡ OptimizaciÃ³nâ€™,meeting:â€˜ğŸ¤ ReuniÃ³nâ€™};var freqs={daily:â€˜Diarioâ€™,weekly:â€˜Semanalâ€™,biweekly:â€˜Quincenalâ€™,monthly:â€˜Mensualâ€™};html+=â€™<div class="list-item"><div class="item-content"><div class="item-title">â€™+(types[c.type]||c.type)+â€™</div><div class="item-meta"><span>â€™+(freqs[c.frequency]||c.frequency)+â€™</span>â€™+(c.day?â€™<span>DÃ­a â€˜+c.day+â€™</span>â€™:â€™â€™)+â€™</div></div><button class="btn btn-sm btn-secondary" onclick="event.stopPropagation();delCalAction(\''+id+'\',\''+c.id+'\')">Ã—</button></div>â€™;});}else{html+=â€™<div class="empty">Sin acciones</div>â€™;}
html+=â€™</div><div class="card"><div class="card-header"><div class="card-title">ğŸ’¸ Comisiones</div><button class="btn btn-sm btn-primary" onclick="showCommissionModal(\''+id+'\')">+</button></div>â€™;
if(com.length){com.forEach(function(c){var p;if(c.type===â€˜managerâ€™)p=DB.getManager(c.personId);else if(c.type===â€˜comercialâ€™)p=DB.getComercial(c.personId);else p=DB.getReferrer(c.personId);var types={manager:â€˜Managerâ€™,comercial:â€˜Comercialâ€™,referrer:â€˜Referidorâ€™};html+=â€™<div class="list-item"><div class="item-content"><div class="item-title">â€™+(p?p.name:â€™-â€™)+â€™</div><div class="item-meta"><span>â€™+types[c.type]+â€™</span><span>â€™+c.percent+â€™%</span></div></div><button class="btn btn-sm btn-secondary" onclick="event.stopPropagation();delCommission(\''+id+'\',\''+c.personId+'\')">Ã—</button></div>â€™;});}else{html+=â€™<div class="empty">Sin comisiones</div>â€™;}
html+=â€™</div></div>â€™;
html+=â€™<div class="card"><div class="card-header"><div class="card-title">ğŸ“ˆ MÃ©tricas</div><button class="btn btn-sm btn-primary" onclick="showMetricModal(\''+id+'\')">+ Mes</button></div>â€™;
if(met.length){html+=â€™<table class="table"><thead><tr><th>Mes</th><th>Leads</th><th>CPL</th><th>InversiÃ³n</th></tr></thead><tbody>â€™;met.forEach(function(m){html+=â€™<tr><td>â€™+m.month+â€™</td><td>â€™+m.leads+â€™</td><td>â€™+U.money(m.cpl)+â€™</td><td>â€™+U.money(m.investment)+â€™</td></tr>â€™;});html+=â€™</tbody></table>â€™;}else{html+=â€™<div class="empty">Sin mÃ©tricas</div>â€™;}
html+=â€™</div>â€™;return html;
}

function pgPipeline(){
var leads=DB.data.leads;var active=LEAD_STAGES.filter(function(s){return s.id!==â€˜wonâ€™&&s.id!==â€˜lostâ€™;});
var pMRR=leads.filter(function(l){return l.stage!==â€˜wonâ€™&&l.stage!==â€˜lostâ€™;}).reduce(function(s,l){return s+(l.mrr||0);},0);
var html=â€™<div class="page-header"><div><h1>ğŸ¯ Pipeline</h1><p>MRR: â€˜+U.money(pMRR)+â€™</p></div><div><button class="btn btn-primary" onclick="showLeadModal()">+ Lead</button></div></div><div class="pipeline">â€™;
active.forEach(function(st){
var stLeads=leads.filter(function(l){return l.stage===st.id;});
html+=â€™<div class="pipeline-col" ondragover="event.preventDefault()" ondrop="dropLead(event,\''+st.id+'\')">â€™;
html+=â€™<div class="pipeline-header"><div class="pipeline-title"><span style="color:'+st.color+'">â—</span> â€˜+st.name+â€™</div><div class="pipeline-count">â€™+stLeads.length+â€™</div></div><div class="pipeline-body">â€™;
stLeads.forEach(function(l){var com=DB.getComercial(l.comercialId);html+=â€™<div class="pipeline-card" draggable="true" ondragstart="dragLead(event,\''+l.id+'\')" onclick="showLeadModal(DB.get(\'leads\',\''+l.id+'\'))"><div style="font-weight:600;font-size:13px;margin-bottom:6px">â€™+l.name+â€™</div><div style="font-size:11px;color:var(--text2);margin-bottom:8px">â€™+(l.contact||â€™-â€™)+â€™</div><div style="display:flex;justify-content:space-between;font-size:11px"><span>â€™+l.accounts+â€™ ctas</span><span style="color:var(--green);font-weight:600">â€™+U.money(l.mrr)+â€™</span></div>â€™+(com?â€™<div style="margin-top:8px;font-size:10px;color:var(--muted)">ğŸ‘¤ â€˜+com.name+â€™</div>â€™:â€™â€™)+â€™</div>â€™;});
html+=â€™</div></div>â€™;
});
var won=leads.filter(function(l){return l.stage===â€˜wonâ€™;});var lost=leads.filter(function(l){return l.stage===â€˜lostâ€™;});
html+=â€™<div class="pipeline-col" style="background:rgba(16,185,129,.1)"><div class="pipeline-header"><div class="pipeline-title"><span style="color:var(--green)">â—</span> Ganados</div><div class="pipeline-count">â€™+won.length+â€™</div></div><div class="pipeline-body">â€™;
won.slice(0,5).forEach(function(l){html+=â€™<div class="pipeline-card" onclick="showLeadModal(DB.get(\'leads\',\''+l.id+'\'))"><div style="font-weight:600;font-size:13px">â€™+l.name+â€™</div><div style="font-size:11px;color:var(--green)">â€™+U.money(l.mrr)+â€™/mes</div></div>â€™;});
html+=â€™</div></div>â€™;
html+=â€™<div class="pipeline-col" style="background:rgba(239,68,68,.1)"><div class="pipeline-header"><div class="pipeline-title"><span style="color:var(--red)">â—</span> Perdidos</div><div class="pipeline-count">â€™+lost.length+â€™</div></div><div class="pipeline-body">â€™;
lost.slice(0,5).forEach(function(l){html+=â€™<div class="pipeline-card" onclick="showLeadModal(DB.get(\'leads\',\''+l.id+'\'))"><div style="font-weight:600;font-size:13px">â€™+l.name+â€™</div></div>â€™;});
html+=â€™</div></div></div>â€™;return html;
}
function dragLead(e,id){e.dataTransfer.setData(â€˜text/plainâ€™,id);}
function dropLead(e,st){e.preventDefault();var id=e.dataTransfer.getData(â€˜text/plainâ€™);DB.update(â€˜leadsâ€™,id,{stage:st});render();UI.toast(â€˜Lead movidoâ€™);}

function pgManagers(){
var mgrs=DB.data.managers;
var html=â€™<div class="page-header"><div><h1>ğŸ‘¤ Managers</h1><p>â€™+mgrs.filter(function(m){return m.active;}).length+â€™ activos</p></div><div><button class="btn btn-primary" onclick="showManagerModal()">+ Manager</button></div></div><div class="grid g2">â€™;
mgrs.forEach(function(m){
var acc=DB.accountsByManager(m.id).filter(function(a){return a.status===â€˜activeâ€™;});var load=U.pct(acc.length,CAP);
html+=â€™<div class="card"><div style="display:flex;align-items:center;gap:14px;margin-bottom:14px"><div class="avatar" style="background:'+m.color+';width:52px;height:52px;font-size:18px">â€™+m.initials+â€™</div><div style="flex:1"><div style="font-weight:600;font-size:15px">â€™+m.name+â€™</div><div style="font-size:12px;color:var(--text2)">â€™+(m.active?â€˜Activoâ€™:â€˜Inactivoâ€™)+â€™ Â· â€˜+U.money(m.salary)+â€™/mes</div></div><button class="btn btn-secondary btn-sm" onclick="showManagerModal(DB.getManager(\''+m.id+'\'))">âœï¸</button></div>â€™;
html+=â€™<div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:6px"><span>Carga: â€˜+acc.length+â€™/â€™+CAP+â€™</span><span style="color:'+(load>=100?'var(--red)':load>=80?'var(--orange)':'var(--green)')+'">â€™+load+â€™%</span></div>â€™;
html+=â€™<div class="progress-bar"><div class="progress-fill" style="width:'+Math.min(load,100)+'%;background:'+(load>=100?'var(--red)':load>=80?'var(--orange)':'var(--green)')+'"></div></div>â€™;
html+=â€™<div style="margin-top:12px;display:flex;gap:6px">â€™;
PLATFORMS.forEach(function(p){var n=acc.filter(function(a){return a.platform===p.id;}).length;if(n)html+=â€™<span style="font-size:11px;background:'+p.color+'22;color:'+p.color+';padding:3px 8px;border-radius:4px">â€™+p.icon+â€™ â€˜+n+â€™</span>â€™;});
html+=â€™</div></div>â€™;
});
html+=â€™</div>â€™;return html;
}

function pgComerciales(){
var coms=DB.data.comerciales;
var html=â€™<div class="page-header"><div><h1>ğŸ’¼ Comerciales</h1><p>â€™+coms.length+â€™ comerciales</p></div><div><button class="btn btn-primary" onclick="showComercialModal()">+ Comercial</button></div></div><div class="grid g2">â€™;
coms.forEach(function(c){
var leads=DB.data.leads.filter(function(l){return l.comercialId===c.id;});
var active=leads.filter(function(l){return l.stage!==â€˜wonâ€™&&l.stage!==â€˜lostâ€™;});
var won=leads.filter(function(l){return l.stage===â€˜wonâ€™;});
html+=â€™<div class="card"><div style="display:flex;align-items:center;gap:14px;margin-bottom:14px"><div class="avatar" style="background:'+c.color+';width:52px;height:52px;font-size:18px">â€™+c.initials+â€™</div><div style="flex:1"><div style="font-weight:600;font-size:15px">â€™+c.name+â€™</div><div style="font-size:12px;color:var(--text2)">â€™+(c.active?â€˜Activoâ€™:â€˜Inactivoâ€™)+â€™ Â· â€˜+U.money(c.salary)+â€™/mes</div></div><button class="btn btn-secondary btn-sm" onclick="showComercialModal(DB.getComercial(\''+c.id+'\'))">âœï¸</button></div>â€™;
html+=â€™<div class="grid g3" style="gap:8px"><div style="text-align:center;padding:10px;background:var(--input);border-radius:8px"><div style="font-size:20px;font-weight:700">â€™+active.length+â€™</div><div style="font-size:10px;color:var(--muted)">Pipeline</div></div><div style="text-align:center;padding:10px;background:var(--input);border-radius:8px"><div style="font-size:20px;font-weight:700;color:var(--green)">â€™+won.length+â€™</div><div style="font-size:10px;color:var(--muted)">Ganados</div></div><div style="text-align:center;padding:10px;background:var(--input);border-radius:8px"><div style="font-size:20px;font-weight:700">â€™+U.money(active.reduce(function(s,l){return s+(l.mrr||0);},0))+â€™</div><div style="font-size:10px;color:var(--muted)">MRR</div></div></div></div>â€™;
});
html+=â€™</div>â€™;return html;
}

function pgReferrers(){
var refs=DB.data.referrers;
var html=â€™<div class="page-header"><div><h1>ğŸ¤ Referidores</h1><p>â€™+refs.length+â€™ referidores</p></div><div><button class="btn btn-primary" onclick="showReferrerModal()">+ Referidor</button></div></div><div class="grid g3">â€™;
refs.forEach(function(r){
var leads=DB.data.leads.filter(function(l){return l.referrerId===r.id;});
var won=leads.filter(function(l){return l.stage===â€˜wonâ€™;});
html+=â€™<div class="card"><div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:12px"><div><div style="font-weight:600;font-size:15px">â€™+r.name+â€™</div><div style="font-size:12px;color:var(--text2)">â€™+(r.company||â€™-â€™)+â€™</div></div><button class="btn btn-secondary btn-sm" onclick="showReferrerModal(DB.getReferrer(\''+r.id+'\'))">âœï¸</button></div>â€™;
html+=â€™<div style="display:flex;gap:12px;margin-bottom:12px"><div style="flex:1;text-align:center;padding:10px;background:var(--input);border-radius:8px"><div style="font-size:18px;font-weight:700">â€™+leads.length+â€™</div><div style="font-size:10px;color:var(--muted)">Leads</div></div><div style="flex:1;text-align:center;padding:10px;background:var(--input);border-radius:8px"><div style="font-size:18px;font-weight:700;color:var(--green)">â€™+won.length+â€™</div><div style="font-size:10px;color:var(--muted)">Ganados</div></div></div>â€™;
html+=â€™<div style="font-size:12px;color:var(--text2)">ComisiÃ³n: â€˜+(r.commission||0)+â€™%</div></div>â€™;
});
html+=â€™</div>â€™;return html;
}
function pgFinance(){
var s=DB.stats();var exp=DB.data.expenses;var byCat={payroll:0,tools:0,other:0};
exp.filter(function(e){return e.monthly;}).forEach(function(e){byCat[e.category]=(byCat[e.category]||0)+e.amount;});
var sc=DB.data.scenario;var proj=[];var curr=s.accounts,currMRR=s.mrr;
for(var i=0;i<12;i++){curr+=sc.newAccMonth;curr=Math.round(curr*(1-sc.churn/100));currMRR=curr*sc.avgFee;proj.push({m:i+1,acc:curr,mrr:currMRR});}
var html=â€™<div class="page-header"><div><h1>ğŸ’° Finanzas</h1><p>MRR = Ingresos Recurrentes Mensuales</p></div><div><button class="btn btn-secondary" onclick="showScenarioModal()">âš™ï¸ Escenario</button> <button class="btn btn-primary" onclick="showExpenseModal()">+ Gasto</button></div></div>â€™;
html+=â€™<div class="grid g4 mb-2"><div class="stat"><div class="stat-icon green">ğŸ’°</div><div class="stat-value">â€™+U.money(s.mrr)+â€™</div><div class="stat-label">MRR</div></div><div class="stat"><div class="stat-icon red">ğŸ’¸</div><div class="stat-value">â€™+U.money(s.expenses)+â€™</div><div class="stat-label">Gastos</div></div><div class="stat"><div class="stat-icon blue">ğŸ“ˆ</div><div class="stat-value">â€™+U.money(s.margin)+â€™</div><div class="stat-label">Margen</div></div><div class="stat"><div class="stat-icon yellow">ğŸ“Š</div><div class="stat-value">â€™+(s.mrr?Math.round((s.margin/s.mrr)*100):0)+â€™%</div><div class="stat-label">% Margen</div></div></div>â€™;
html+=â€™<div class="grid g2 mb-2"><div class="card"><div class="card-title mb-1">ğŸ“Š Ingresos</div><div style="padding:12px 0;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;font-size:13px"><span>â€™+s.accounts+â€™ cuentas Ã— â€˜+U.money(FEE)+â€™</span><span style="font-weight:600;color:var(--green)">â€™+U.money(s.mrr)+â€™</span></div><div style="padding:12px 0;display:flex;justify-content:space-between;font-size:13px"><span>ARR proyectado</span><span style="font-weight:600">â€™+U.money(s.mrr*12)+â€™</span></div></div>â€™;
html+=â€™<div class="card"><div class="card-title mb-1">ğŸ’¸ Gastos</div>â€™;
var cats={payroll:â€˜ğŸ‘¤ NÃ³minasâ€™,tools:â€˜ğŸ”§ Herramientasâ€™,other:â€˜ğŸ“¦ Otrosâ€™};
for(var k in cats){html+=â€™<div style="padding:10px 0;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;font-size:13px"><span>â€™+cats[k]+â€™</span><span>â€™+U.money(byCat[k])+â€™</span></div>â€™;}
html+=â€™<div style="padding:10px 0;display:flex;justify-content:space-between;font-size:13px;font-weight:600"><span>Total</span><span style="color:var(--red)">â€™+U.money(s.expenses)+â€™</span></div></div></div>â€™;
html+=â€™<div class="card mb-2"><div class="card-header"><div class="card-title">ğŸ“ˆ ProyecciÃ³n 12 meses</div><span style="font-size:11px;color:var(--muted)">â€™+sc.newAccMonth+â€™ nuevas/mes Â· â€˜+sc.churn+â€™% churn</span></div>â€™;
var maxMRR=Math.max.apply(null,proj.map(function(p){return p.mrr;}));
html+=â€™<div style="display:flex;align-items:flex-end;gap:8px;height:140px;padding:16px 0">â€™;
proj.forEach(function(p,i){var h=Math.round((p.mrr/maxMRR)*100);html+=â€™<div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:4px"><span style="font-size:9px;color:var(--muted)">â€™+U.money(p.mrr)+â€™</span><div style="width:100%;height:'+h+'px;background:linear-gradient(to top,var(--accent),var(--yellow));border-radius:4px 4px 0 0"></div><span style="font-size:10px;color:var(--text2)">Mâ€™+(i+1)+â€™</span></div>â€™;});
html+=â€™</div></div>â€™;
html+=â€™<div class="card"><div class="card-header"><div class="card-title">ğŸ“‹ Detalle gastos</div></div><table class="table"><thead><tr><th>Concepto</th><th>CategorÃ­a</th><th>Importe</th><th></th></tr></thead><tbody>â€™;
var catNames={payroll:â€˜NÃ³minaâ€™,tools:â€˜Herramientasâ€™,other:â€˜Otrosâ€™};
exp.forEach(function(e){html+=â€™<tr><td>â€™+e.name+â€™</td><td>â€™+catNames[e.category]+â€™</td><td>â€™+U.money(e.amount)+â€™</td><td><button class="btn btn-sm btn-secondary" onclick="showExpenseModal(DB.get(\'expenses\',\''+e.id+'\'))">âœï¸</button></td></tr>â€™;});
html+=â€™</tbody></table></div>â€™;return html;
}

function pgTasks(){
var tasks=DB.data.tasks;var pend=tasks.filter(function(t){return t.status!==â€˜doneâ€™;});var done=tasks.filter(function(t){return t.status===â€˜doneâ€™;});
var html=â€™<div class="page-header"><div><h1>âœ… Tareas</h1><p>â€™+pend.length+â€™ pendientes</p></div><div><button class="btn btn-primary" onclick="showTaskModal()">+ Tarea</button></div></div><div class="grid g2"><div class="card"><div class="card-title mb-1">ğŸ“‹ Pendientes</div>â€™;
if(pend.length){pend.forEach(function(t){var acc=t.accountId?DB.get(â€˜accountsâ€™,t.accountId):null;var cl=acc?DB.getClient(acc.clientId):null;var mg=t.managerId?DB.getManager(t.managerId):null;var colors={high:â€˜rgba(239,68,68,.15)â€™,urgent:â€˜rgba(239,68,68,.25)â€™,medium:â€˜rgba(234,179,8,.15)â€™,low:â€˜rgba(113,113,122,.15)â€™};var textColors={high:â€˜var(â€“red)â€™,urgent:â€˜var(â€“red)â€™,medium:â€˜var(â€“yellow)â€™,low:â€˜var(â€“muted)â€™};html+=â€™<div class="list-item" onclick="showTaskModal(DB.get(\'tasks\',\''+t.id+'\'))"><input type="checkbox" onclick="event.stopPropagation();toggleTask(\''+t.id+'\')" style="width:18px;height:18px"><div class="item-content"><div class="item-title">â€™+t.title+â€™</div><div class="item-meta">â€™+(cl?â€™<span>â€™+cl.name+â€™</span>â€™:â€™â€™)+(mg?â€™<span>ğŸ‘¤ â€˜+mg.name.split(â€™ â€˜)[0]+â€™</span>â€™:â€™â€™)+(t.due?â€™<span>ğŸ“… â€˜+U.date(t.due)+â€™</span>â€™:â€™â€™)+â€™</div></div><span class="tag" style="background:'+colors[t.priority]+';color:'+textColors[t.priority]+'">â€™+t.priority+â€™</span></div>â€™;});}else{html+=â€™<div class="empty">Sin tareas ğŸ‰</div>â€™;}
html+=â€™</div><div class="card"><div class="card-title mb-1">âœ“ Completadas</div>â€™;
if(done.length){done.slice(0,8).forEach(function(t){html+=â€™<div class="list-item" style="opacity:.6" onclick="showTaskModal(DB.get(\'tasks\',\''+t.id+'\'))"><input type="checkbox" checked onclick="event.stopPropagation();toggleTask(\''+t.id+'\')" style="width:18px;height:18px"><div class="item-content"><div class="item-title" style="text-decoration:line-through">â€™+t.title+â€™</div></div></div>â€™;});}else{html+=â€™<div class="empty">-</div>â€™;}
html+=â€™</div></div>â€™;return html;
}
function toggleTask(id){var t=DB.get(â€˜tasksâ€™,id);DB.update(â€˜tasksâ€™,id,{status:t.status===â€˜doneâ€™?â€˜pendingâ€™:â€˜doneâ€™});render();}

function pgObjectives(){
var objs=DB.data.objectives;var byArea={growth:[],revenue:[],team:[]};objs.forEach(function(o){if(byArea[o.area])byArea[o.area].push(o);});
var html=â€™<div class="page-header"><div><h1>ğŸ¯ Objetivos</h1></div><div><button class="btn btn-primary" onclick="showObjectiveModal()">+ Objetivo</button></div></div><div class="grid g3">â€™;
var areas={growth:â€˜ğŸ“ˆ Crecimientoâ€™,revenue:â€˜ğŸ’° Ingresosâ€™,team:â€˜ğŸ‘¥ Equipoâ€™};
for(var k in areas){html+=â€™<div class="card"><div class="card-title mb-1">â€™+areas[k]+â€™</div>â€™;if(byArea[k].length){byArea[k].forEach(function(o){var p=U.pct(o.current,o.target);html+=â€™<div style="margin-bottom:14px;cursor:pointer" onclick="showObjectiveModal(DB.get(\'objectives\',\''+o.id+'\'))"><div style="font-size:13px;font-weight:500;margin-bottom:6px">â€™+o.title+â€™</div><div class="progress-bar mb-1"><div class="progress-fill" style="width:'+p+'%;background:'+U.progColor(p)+'"></div></div><div style="display:flex;justify-content:space-between;font-size:11px;color:var(--muted)"><span>â€™+o.current+â€™/â€™+o.target+â€™ â€˜+o.unit+â€™</span><span style="color:'+U.progColor(p)+'">â€™+p+â€™%</span></div></div>â€™;});}else{html+=â€™<div class="empty">-</div>â€™;}html+=â€™</div>â€™;}
html+=â€™</div>â€™;return html;
}

function pgDecisions(){
var dec=DB.data.decisions;var pend=dec.filter(function(d){return!d.decided;});var done=dec.filter(function(d){return d.decided;});
var html=â€™<div class="page-header"><div><h1>âš¡ Decisiones</h1><p>â€™+pend.length+â€™ pendientes</p></div><div><button class="btn btn-primary" onclick="showDecisionModal()">+ DecisiÃ³n</button></div></div><div class="grid g2"><div class="card"><div class="card-title mb-1">â³ Pendientes</div>â€™;
if(pend.length){pend.forEach(function(d){html+=â€™<div class="list-item" onclick="showDecisionModal(DB.get(\'decisions\',\''+d.id+'\'))"><div class="item-content"><div class="item-title">â€™+d.title+â€™</div><div class="item-meta">â€™+(d.context?â€™<span>â€™+d.context.slice(0,50)+â€™â€¦</span>â€™:â€™â€™)+(d.deadline?â€™<span>ğŸ“… â€˜+U.date(d.deadline)+â€™</span>â€™:â€™â€™)+â€™</div></div></div>â€™;});}else{html+=â€™<div class="empty">Sin decisiones ğŸ‰</div>â€™;}
html+=â€™</div><div class="card"><div class="card-title mb-1">âœ“ Decididas</div>â€™;
if(done.length){done.slice(0,5).forEach(function(d){html+=â€™<div class="list-item" style="opacity:.6" onclick="showDecisionModal(DB.get(\'decisions\',\''+d.id+'\'))"><div class="item-content"><div class="item-title">â€™+d.title+â€™</div></div></div>â€™;});}else{html+=â€™<div class="empty">-</div>â€™;}
html+=â€™</div></div>â€™;return html;
}

function pgOpportunities(){
var ops=DB.data.opportunities;
var html=â€™<div class="page-header"><div><h1>ğŸ’¡ Oportunidades</h1></div><div><button class="btn btn-primary" onclick="showOpportunityModal()">+ Oportunidad</button></div></div><div class="grid g3">â€™;
if(ops.length){ops.forEach(function(o){var colors={idea:â€˜var(â€“purple)â€™,exploring:â€˜var(â€“blue)â€™,launched:â€˜var(â€“green)â€™};var names={idea:â€˜Ideaâ€™,exploring:â€˜Explorandoâ€™,launched:â€˜Lanzadoâ€™};html+=â€™<div class="card" onclick="showOpportunityModal(DB.get(\'opportunities\',\''+o.id+'\'))" style="cursor:pointer"><div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px"><div class="card-title">â€™+o.title+â€™</div><span class="tag" style="background:'+colors[o.status]+'22;color:'+colors[o.status]+'">â€™+names[o.status]+â€™</span></div><div style="font-size:12px;color:var(--text2);margin-bottom:10px">â€™+(o.desc||â€™-â€™)+â€™</div><div style="font-size:14px;font-weight:600;color:var(--green)">â€™+U.money(o.potential)+â€™ potencial</div></div>â€™;});}else{html+=â€™<div class="empty">Sin oportunidades</div>â€™;}
html+=â€™</div>â€™;return html;
}

function pgProjects(){
var prs=DB.data.projects;
var html=â€™<div class="page-header"><div><h1>ğŸš€ Proyectos</h1></div><div><button class="btn btn-primary" onclick="showProjectModal()">+ Proyecto</button></div></div><div class="grid g2">â€™;
if(prs.length){prs.forEach(function(p){var colors={active:â€˜var(â€“green)â€™,paused:â€˜var(â€“orange)â€™,done:â€˜var(â€“blue)â€™};var names={active:â€˜Activoâ€™,paused:â€˜Pausadoâ€™,done:â€˜Completadoâ€™};html+=â€™<div class="card" onclick="showProjectModal(DB.get(\'projects\',\''+p.id+'\'))" style="cursor:pointer"><div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:10px"><div class="card-title">â€™+p.title+â€™</div><span class="tag" style="background:'+colors[p.status]+'22;color:'+colors[p.status]+'">â€™+names[p.status]+â€™</span></div><div style="font-size:12px;color:var(--text2);margin-bottom:12px">â€™+(p.desc||â€™-â€™)+â€™</div><div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:6px"><span>Progreso</span><span>â€™+p.progress+â€™%</span></div><div class="progress-bar"><div class="progress-fill" style="width:'+p.progress+'%;background:var(--accent)"></div></div></div>â€™;});}else{html+=â€™<div class="empty">Sin proyectos</div>â€™;}
html+=â€™</div>â€™;return html;
}

function pgInbox(){
var inbox=DB.data.inbox;
var html=â€™<div class="page-header"><div><h1>ğŸ“¥ Inbox</h1><p>Captura rÃ¡pida</p></div></div><div class="card mb-2"><form onsubmit="addInbox(event)"><div class="form-row"><input class="form-input" name="text" placeholder="Nueva idea..." style="flex:1"><button class="btn btn-primary" type="submit">AÃ±adir</button></div></form></div><div class="card">â€™;
if(inbox.length){inbox.forEach(function(i){html+=â€™<div class="list-item"><div class="item-content"><div class="item-title">â€™+i.text+â€™</div><div class="item-meta"><span>â€™+U.date(i.created)+â€™</span></div></div><div style="display:flex;gap:6px"><button class="btn btn-sm btn-secondary" onclick="convertInbox(\''+i.id+'\',\'task\')">â†’ Tarea</button><button class="btn btn-sm btn-secondary" onclick="convertInbox(\''+i.id+'\',\'decision\')">â†’ DecisiÃ³n</button><button class="btn btn-sm btn-danger" onclick="delInbox(\''+i.id+'\')">Ã—</button></div></div>â€™;});}else{html+=â€™<div class="empty">Inbox vacÃ­o</div>â€™;}
html+=â€™</div>â€™;return html;
}
function addInbox(e){e.preventDefault();var t=e.target.text.value.trim();if(t){DB.add(â€˜inboxâ€™,{text:t,created:U.today()});e.target.reset();render();UI.toast(â€˜AÃ±adidoâ€™);}}
function delInbox(id){DB.del(â€˜inboxâ€™,id);render();}
function convertInbox(id,type){var i=DB.get(â€˜inboxâ€™,id);if(type===â€˜taskâ€™){DB.add(â€˜tasksâ€™,{title:i.text,status:â€˜pendingâ€™,priority:â€˜mediumâ€™});UI.toast(â€˜Convertido a tareaâ€™);}else{DB.add(â€˜decisionsâ€™,{title:i.text,decided:false});UI.toast(â€˜Convertido a decisiÃ³nâ€™);}DB.del(â€˜inboxâ€™,id);render();}

function pgSettings(){
var html=â€™<div class="page-header"><div><h1>âš™ï¸ Config</h1></div></div><div class="grid g2"><div class="card"><div class="card-title mb-1">ğŸ¢ Empresa</div><form onsubmit="saveCo(event)"><div class="form-group"><label class="form-label">Nombre</label><input class="form-input" name="name" value="'+DB.data.company.name+'"></div><button class="btn btn-primary" type="submit">Guardar</button></form></div><div class="card"><div class="card-title mb-1">âš ï¸ Datos</div><p style="font-size:12px;color:var(--text2);margin-bottom:12px">Datos en localStorage</p><button class="btn btn-danger" onclick="confirmReset()">Resetear</button></div></div>â€™;
return html;
}
function saveCo(e){e.preventDefault();DB.data.company.name=e.target.name.value;DB.save();UI.toast(â€˜Guardadoâ€™);render();}
function confirmReset(){UI.confirm(â€™Â¿Resetear TODO?â€™,â€˜DB.reset();location.reload()â€™);}
function showClientModal(c){
var ed=c?true:false;c=c||{};
var html=â€™<form id="clientForm"><div class="form-group"><label class="form-label">Nombre *</label><input class="form-input" name="name" value="'+(c.name||'')+'" required></div><div class="form-row"><div class="form-group"><label class="form-label">Contacto</label><input class="form-input" name="contact" value="'+(c.contact||'')+'"></div><div class="form-group"><label class="form-label">Email</label><input class="form-input" name="email" value="'+(c.email||'')+'"></div></div><div class="form-row"><div class="form-group"><label class="form-label">TelÃ©fono</label><input class="form-input" name="phone" value="'+(c.phone||'')+'"></div><div class="form-group"><label class="form-label">Cliente desde</label><input type="month" class="form-input" name="since" value="'+(c.since||'')+'"></div></div><div class="form-group"><label class="form-label">Notas</label><textarea class="form-textarea" name="notes">â€™+(c.notes||â€™â€™)+â€™</textarea></div><input type="hidden" name="id" value="'+(c.id||'')+'"><input type="hidden" name="sentiment" value="'+(c.sentiment||'neutral')+'"></form>â€™;
var footer=(ed?â€™<button class="btn btn-danger" onclick="delClient(\''+c.id+'\')">Eliminar</button>â€™:â€™â€™)+â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveClient()">Guardar</button>â€™;
UI.modal(ed?â€˜Editar clienteâ€™:â€˜Nuevo clienteâ€™,html,footer,â€˜lgâ€™);
}
function saveClient(){var f=document.getElementById(â€˜clientFormâ€™);var d=Object.fromEntries(new FormData(f));if(!d.name||!d.name.trim()){UI.toast(â€˜Nombre requeridoâ€™,â€˜errorâ€™);return;}if(d.id){DB.update(â€˜clientsâ€™,d.id,d);UI.toast(â€˜Actualizadoâ€™);}else{delete d.id;DB.add(â€˜clientsâ€™,d);UI.toast(â€˜Creadoâ€™);}UI.closeModal();render();}
function delClient(id){UI.confirm(â€˜Eliminar cliente?â€™,â€˜DB.del(â€œclientsâ€,â€â€™+id+â€™â€);UI.closeModal();closeDetail()â€™);}

function showAccountModal(a,clientId){
var ed=a?true:false;a=a||{};
var clientOpts=â€™<option value="">Seleccionarâ€¦</option>â€™;DB.data.clients.forEach(function(c){clientOpts+=â€™<option value=â€â€™+c.id+â€™â€ â€˜+((a.clientId||clientId)===c.id?â€˜selectedâ€™:â€™â€™)+â€™>â€™+c.name+â€™</option>â€™;});
var platOpts=â€™â€™;PLATFORMS.forEach(function(p){platOpts+=â€™<option value=â€â€™+p.id+â€™â€ â€˜+(a.platform===p.id?â€˜selectedâ€™:â€™â€™)+â€™>â€™+p.name+â€™</option>â€™;});
var statOpts=â€™â€™;ACCOUNT_STATUS.forEach(function(s){statOpts+=â€™<option value=â€â€™+s.id+â€™â€ â€˜+(a.status===s.id?â€˜selectedâ€™:â€™â€™)+â€™>â€™+s.name+â€™</option>â€™;});
var mgrOpts=â€™â€™;DB.data.managers.forEach(function(m){mgrOpts+=â€™<option value=â€â€™+m.id+â€™â€ â€˜+(a.managerId===m.id?â€˜selectedâ€™:â€™â€™)+â€™>â€™+m.name+â€™</option>â€™;});
var html=â€™<form id="accountForm"><div class="form-group"><label class="form-label">Cliente *</label><select class="form-select" name="clientId" required>â€™+clientOpts+â€™</select></div><div class="form-row"><div class="form-group"><label class="form-label">Plataforma</label><select class="form-select" name="platform">â€™+platOpts+â€™</select></div><div class="form-group"><label class="form-label">Estado</label><select class="form-select" name="status">â€™+statOpts+â€™</select></div></div><div class="form-row"><div class="form-group"><label class="form-label">Manager</label><select class="form-select" name="managerId">â€™+mgrOpts+â€™</select></div><div class="form-group"><label class="form-label">Fee</label><input type="number" class="form-input" name="fee" value="'+(a.fee||FEE)+'"></div></div><div class="form-group"><label class="form-label">Inversion</label><input type="number" class="form-input" name="investment" value="'+(a.investment||'')+'"></div><input type="hidden" name="id" value="'+(a.id||'')+'"></form>â€™;
var footer=(ed?â€™<button class="btn btn-danger" onclick="delAccount(\''+a.id+'\')">Eliminar</button>â€™:â€™â€™)+â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveAccount()">Guardar</button>â€™;
UI.modal(ed?â€˜Editar cuentaâ€™:â€˜Nueva cuentaâ€™,html,footer,â€˜lgâ€™);
}
function saveAccount(){var f=document.getElementById(â€˜accountFormâ€™);var d=Object.fromEntries(new FormData(f));if(!d.clientId){UI.toast(â€˜Cliente requeridoâ€™,â€˜errorâ€™);return;}d.fee=parseInt(d.fee)||FEE;d.investment=parseInt(d.investment)||0;if(d.id){DB.update(â€˜accountsâ€™,d.id,d);UI.toast(â€˜Actualizadoâ€™);}else{delete d.id;d.metrics=[];d.calendarActions=[];d.commissions=[];DB.add(â€˜accountsâ€™,d);UI.toast(â€˜Creadoâ€™);}UI.closeModal();render();}
function delAccount(id){UI.confirm(â€˜Eliminar cuenta?â€™,â€˜DB.del(â€œaccountsâ€,â€â€™+id+â€™â€);UI.closeModal();closeDetail()â€™);}

function showLeadModal(l){
var ed=l?true:false;l=l||{};
var stageOpts=â€™â€™;LEAD_STAGES.forEach(function(s){stageOpts+=â€™<option value=â€â€™+s.id+â€™â€ â€˜+(l.stage===s.id?â€˜selectedâ€™:â€™â€™)+â€™>â€™+s.name+â€™</option>â€™;});
var comOpts=â€™<option value="">-</option>â€™;DB.data.comerciales.forEach(function(c){comOpts+=â€™<option value=â€â€™+c.id+â€™â€ â€˜+(l.comercialId===c.id?â€˜selectedâ€™:â€™â€™)+â€™>â€™+c.name+â€™</option>â€™;});
var refOpts=â€™<option value="">-</option>â€™;DB.data.referrers.forEach(function(r){refOpts+=â€™<option value=â€â€™+r.id+â€™â€ â€˜+(l.referrerId===r.id?â€˜selectedâ€™:â€™â€™)+â€™>â€™+r.name+â€™</option>â€™;});
var html=â€™<form id="leadForm"><div class="form-row"><div class="form-group"><label class="form-label">Nombre *</label><input class="form-input" name="name" value="'+(l.name||'')+'" required></div><div class="form-group"><label class="form-label">Contacto</label><input class="form-input" name="contact" value="'+(l.contact||'')+'"></div></div><div class="form-row"><div class="form-group"><label class="form-label">Cuentas</label><input type="number" class="form-input" name="accounts" value="'+(l.accounts||1)+'"></div><div class="form-group"><label class="form-label">MRR</label><input type="number" class="form-input" name="mrr" value="'+(l.mrr||350)+'"></div></div><div class="form-row"><div class="form-group"><label class="form-label">Etapa</label><select class="form-select" name="stage">â€™+stageOpts+â€™</select></div><div class="form-group"><label class="form-label">Origen</label><select class="form-select" name="source"><option value=â€œwebâ€ â€˜+(l.source===â€˜webâ€™?â€˜selectedâ€™:â€™â€™)+â€™>Web</option><option value=â€œreferralâ€ â€˜+(l.source===â€˜referralâ€™?â€˜selectedâ€™:â€™â€™)+â€™>Referido</option><option value=â€œcoldâ€ â€˜+(l.source===â€˜coldâ€™?â€˜selectedâ€™:â€™â€™)+â€™>Frio</option></select></div></div><div class="form-row"><div class="form-group"><label class="form-label">Comercial</label><select class="form-select" name="comercialId">â€™+comOpts+â€™</select></div><div class="form-group"><label class="form-label">Referidor</label><select class="form-select" name="referrerId">â€™+refOpts+â€™</select></div></div><div class="form-group"><label class="form-label">Notas</label><textarea class="form-textarea" name="notes">â€™+(l.notes||â€™â€™)+â€™</textarea></div><input type="hidden" name="id" value="'+(l.id||'')+'"><input type="hidden" name="created" value="'+(l.created||U.today())+'"></form>â€™;
var footer=(ed?â€™<button class="btn btn-danger" onclick="delLead(\''+l.id+'\')">Eliminar</button>â€™:â€™â€™)+â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveLead()">Guardar</button>â€™;
UI.modal(ed?â€˜Editar leadâ€™:â€˜Nuevo leadâ€™,html,footer,â€˜lgâ€™);
}
function saveLead(){var f=document.getElementById(â€˜leadFormâ€™);var d=Object.fromEntries(new FormData(f));if(!d.name||!d.name.trim()){UI.toast(â€˜Nombre requeridoâ€™,â€˜errorâ€™);return;}d.accounts=parseInt(d.accounts)||1;d.mrr=parseInt(d.mrr)||350;if(d.id){DB.update(â€˜leadsâ€™,d.id,d);UI.toast(â€˜Actualizadoâ€™);}else{delete d.id;DB.add(â€˜leadsâ€™,d);UI.toast(â€˜Creadoâ€™);}UI.closeModal();render();}
function delLead(id){UI.confirm(â€˜Eliminar lead?â€™,â€˜DB.del(â€œleadsâ€,â€â€™+id+â€™â€);UI.closeModal()â€™);}

function showManagerModal(m){
var ed=m?true:false;m=m||{};
var html=â€™<form id="mgrForm"><div class="form-row"><div class="form-group"><label class="form-label">Nombre *</label><input class="form-input" name="name" value="'+(m.name||'')+'" required></div><div class="form-group"><label class="form-label">Iniciales</label><input class="form-input" name="initials" value="'+(m.initials||'')+'" maxlength="2"></div></div><div class="form-row"><div class="form-group"><label class="form-label">Salario</label><input type="number" class="form-input" name="salary" value="'+(m.salary||2200)+'"></div><div class="form-group"><label class="form-label">Estado</label><select class="form-select" name="active"><option value=â€œtrueâ€ â€˜+(m.active!==false?â€˜selectedâ€™:â€™â€™)+â€™>Activo</option><option value=â€œfalseâ€ â€˜+(m.active===false?â€˜selectedâ€™:â€™â€™)+â€™>Inactivo</option></select></div></div><input type="hidden" name="id" value="'+(m.id||'')+'"><input type="hidden" name="color" value="'+(m.color||'linear-gradient(135deg,#f97316,#eab308)')+'"></form>â€™;
var footer=(ed?â€™<button class="btn btn-danger" onclick="delManager(\''+m.id+'\')">Eliminar</button>â€™:â€™â€™)+â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveManager()">Guardar</button>â€™;
UI.modal(ed?â€˜Editar managerâ€™:â€˜Nuevo managerâ€™,html,footer);
}
function saveManager(){var f=document.getElementById(â€˜mgrFormâ€™);var d=Object.fromEntries(new FormData(f));if(!d.name||!d.name.trim()){UI.toast(â€˜Nombre requeridoâ€™,â€˜errorâ€™);return;}d.salary=parseInt(d.salary)||2200;d.active=d.active===â€˜trueâ€™;if(!d.initials)d.initials=d.name.split(â€™ â€˜).map(function(w){return w[0];}).join(â€™â€™).toUpperCase().slice(0,2);if(d.id){DB.update(â€˜managersâ€™,d.id,d);UI.toast(â€˜Actualizadoâ€™);}else{delete d.id;DB.add(â€˜managersâ€™,d);UI.toast(â€˜Creadoâ€™);}UI.closeModal();render();}
function delManager(id){UI.confirm(â€˜Eliminar manager?â€™,â€˜DB.del(â€œmanagersâ€,â€â€™+id+â€™â€);UI.closeModal()â€™);}

function showComercialModal(c){
var ed=c?true:false;c=c||{};
var html=â€™<form id="comForm"><div class="form-row"><div class="form-group"><label class="form-label">Nombre *</label><input class="form-input" name="name" value="'+(c.name||'')+'" required></div><div class="form-group"><label class="form-label">Iniciales</label><input class="form-input" name="initials" value="'+(c.initials||'')+'" maxlength="2"></div></div><div class="form-row"><div class="form-group"><label class="form-label">Salario</label><input type="number" class="form-input" name="salary" value="'+(c.salary||1800)+'"></div><div class="form-group"><label class="form-label">Estado</label><select class="form-select" name="active"><option value=â€œtrueâ€ â€˜+(c.active!==false?â€˜selectedâ€™:â€™â€™)+â€™>Activo</option><option value=â€œfalseâ€ â€˜+(c.active===false?â€˜selectedâ€™:â€™â€™)+â€™>Inactivo</option></select></div></div><input type="hidden" name="id" value="'+(c.id||'')+'"><input type="hidden" name="color" value="'+(c.color||'linear-gradient(135deg,#ec4899,#f97316)')+'"></form>â€™;
var footer=(ed?â€™<button class="btn btn-danger" onclick="delComercial(\''+c.id+'\')">Eliminar</button>â€™:â€™â€™)+â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveComercial()">Guardar</button>â€™;
UI.modal(ed?â€˜Editar comercialâ€™:â€˜Nuevo comercialâ€™,html,footer);
}
function saveComercial(){var f=document.getElementById(â€˜comFormâ€™);var d=Object.fromEntries(new FormData(f));if(!d.name||!d.name.trim()){UI.toast(â€˜Nombre requeridoâ€™,â€˜errorâ€™);return;}d.salary=parseInt(d.salary)||1800;d.active=d.active===â€˜trueâ€™;if(!d.initials)d.initials=d.name.split(â€™ â€˜).map(function(w){return w[0];}).join(â€™â€™).toUpperCase().slice(0,2);if(d.id){DB.update(â€˜comercialesâ€™,d.id,d);UI.toast(â€˜Actualizadoâ€™);}else{delete d.id;DB.add(â€˜comercialesâ€™,d);UI.toast(â€˜Creadoâ€™);}UI.closeModal();render();}
function delComercial(id){UI.confirm(â€˜Eliminar comercial?â€™,â€˜DB.del(â€œcomercialesâ€,â€â€™+id+â€™â€);UI.closeModal()â€™);}

function showReferrerModal(r){
var ed=r?true:false;r=r||{};
var html=â€™<form id="refForm"><div class="form-group"><label class="form-label">Nombre *</label><input class="form-input" name="name" value="'+(r.name||'')+'" required></div><div class="form-row"><div class="form-group"><label class="form-label">Empresa</label><input class="form-input" name="company" value="'+(r.company||'')+'"></div><div class="form-group"><label class="form-label">Comision %</label><input type="number" class="form-input" name="commission" value="'+(r.commission||10)+'"></div></div><div class="form-group"><label class="form-label">Notas</label><textarea class="form-textarea" name="notes">â€™+(r.notes||â€™â€™)+â€™</textarea></div><input type="hidden" name="id" value="'+(r.id||'')+'"></form>â€™;
var footer=(ed?â€™<button class="btn btn-danger" onclick="delReferrer(\''+r.id+'\')">Eliminar</button>â€™:â€™â€™)+â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveReferrer()">Guardar</button>â€™;
UI.modal(ed?â€˜Editar referidorâ€™:â€˜Nuevo referidorâ€™,html,footer);
}
function saveReferrer(){var f=document.getElementById(â€˜refFormâ€™);var d=Object.fromEntries(new FormData(f));if(!d.name||!d.name.trim()){UI.toast(â€˜Nombre requeridoâ€™,â€˜errorâ€™);return;}d.commission=parseInt(d.commission)||10;if(d.id){DB.update(â€˜referrersâ€™,d.id,d);UI.toast(â€˜Actualizadoâ€™);}else{delete d.id;DB.add(â€˜referrersâ€™,d);UI.toast(â€˜Creadoâ€™);}UI.closeModal();render();}
function delReferrer(id){UI.confirm(â€˜Eliminar referidor?â€™,â€˜DB.del(â€œreferrersâ€,â€â€™+id+â€™â€);UI.closeModal()â€™);}
function showTaskModal(t){
var ed=t?true:false;t=t||{};
var accOpts=â€™<option value="">General</option>â€™;DB.data.accounts.forEach(function(a){var cl=DB.getClient(a.clientId);var pl=PLATFORMS.find(function(p){return p.id===a.platform;});accOpts+=â€™<option value=â€â€™+a.id+â€™â€ â€˜+(t.accountId===a.id?â€˜selectedâ€™:â€™â€™)+â€™>â€™+(cl?cl.name:â€™-â€™)+â€™ - â€˜+pl.name+â€™</option>â€™;});
var mgrOpts=â€™â€™;DB.data.managers.forEach(function(m){mgrOpts+=â€™<option value=â€â€™+m.id+â€™â€ â€˜+(t.managerId===m.id?â€˜selectedâ€™:â€™â€™)+â€™>â€™+m.name+â€™</option>â€™;});
var html=â€™<form id="taskForm"><div class="form-group"><label class="form-label">Tarea *</label><input class="form-input" name="title" value="'+(t.title||'')+'" required></div><div class="form-row"><div class="form-group"><label class="form-label">Cuenta</label><select class="form-select" name="accountId">â€™+accOpts+â€™</select></div><div class="form-group"><label class="form-label">Manager</label><select class="form-select" name="managerId">â€™+mgrOpts+â€™</select></div></div><div class="form-row"><div class="form-group"><label class="form-label">Fecha</label><input type="date" class="form-input" name="due" value="'+(t.due||'')+'"></div><div class="form-group"><label class="form-label">Prioridad</label><select class="form-select" name="priority"><option value=â€œlowâ€ â€˜+(t.priority===â€˜lowâ€™?â€˜selectedâ€™:â€™â€™)+â€™>Baja</option><option value=â€œmediumâ€ â€˜+(t.priority===â€˜mediumâ€™||!t.priority?â€˜selectedâ€™:â€™â€™)+â€™>Media</option><option value=â€œhighâ€ â€˜+(t.priority===â€˜highâ€™?â€˜selectedâ€™:â€™â€™)+â€™>Alta</option><option value=â€œurgentâ€ â€˜+(t.priority===â€˜urgentâ€™?â€˜selectedâ€™:â€™â€™)+â€™>Urgente</option></select></div></div><input type="hidden" name="id" value="'+(t.id||'')+'"><input type="hidden" name="status" value="'+(t.status||'pending')+'"></form>â€™;
var footer=(ed?â€™<button class="btn btn-danger" onclick="delTask(\''+t.id+'\')">Eliminar</button>â€™:â€™â€™)+â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveTask()">Guardar</button>â€™;
UI.modal(ed?â€˜Editar tareaâ€™:â€˜Nueva tareaâ€™,html,footer);
}
function saveTask(){var f=document.getElementById(â€˜taskFormâ€™);var d=Object.fromEntries(new FormData(f));if(!d.title||!d.title.trim()){UI.toast(â€˜Titulo requeridoâ€™,â€˜errorâ€™);return;}if(d.id){DB.update(â€˜tasksâ€™,d.id,d);UI.toast(â€˜Actualizadoâ€™);}else{delete d.id;DB.add(â€˜tasksâ€™,d);UI.toast(â€˜Creadoâ€™);}UI.closeModal();render();}
function delTask(id){UI.confirm(â€˜Eliminar tarea?â€™,â€˜DB.del(â€œtasksâ€,â€â€™+id+â€™â€);UI.closeModal()â€™);}

function showExpenseModal(e){
var ed=e?true:false;e=e||{};
var html=â€™<form id="expForm"><div class="form-group"><label class="form-label">Concepto *</label><input class="form-input" name="name" value="'+(e.name||'')+'" required></div><div class="form-row"><div class="form-group"><label class="form-label">Importe</label><input type="number" class="form-input" name="amount" value="'+(e.amount||'')+'" required></div><div class="form-group"><label class="form-label">Categoria</label><select class="form-select" name="category"><option value=â€œpayrollâ€ â€˜+(e.category===â€˜payrollâ€™?â€˜selectedâ€™:â€™â€™)+â€™>Nomina</option><option value=â€œtoolsâ€ â€˜+(e.category===â€˜toolsâ€™?â€˜selectedâ€™:â€™â€™)+â€™>Herramientas</option><option value=â€œotherâ€ â€˜+(e.category===â€˜otherâ€™||!e.category?â€˜selectedâ€™:â€™â€™)+â€™>Otros</option></select></div></div><input type="hidden" name="id" value="'+(e.id||'')+'"><input type="hidden" name="monthly" value="true"></form>â€™;
var footer=(ed?â€™<button class="btn btn-danger" onclick="delExpense(\''+e.id+'\')">Eliminar</button>â€™:â€™â€™)+â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveExpense()">Guardar</button>â€™;
UI.modal(ed?â€˜Editar gastoâ€™:â€˜Nuevo gastoâ€™,html,footer);
}
function saveExpense(){var f=document.getElementById(â€˜expFormâ€™);var d=Object.fromEntries(new FormData(f));if(!d.name||!d.name.trim()){UI.toast(â€˜Concepto requeridoâ€™,â€˜errorâ€™);return;}d.amount=parseInt(d.amount)||0;d.monthly=true;if(d.id){DB.update(â€˜expensesâ€™,d.id,d);UI.toast(â€˜Actualizadoâ€™);}else{delete d.id;DB.add(â€˜expensesâ€™,d);UI.toast(â€˜Creadoâ€™);}UI.closeModal();render();}
function delExpense(id){UI.confirm(â€˜Eliminar gasto?â€™,â€˜DB.del(â€œexpensesâ€,â€â€™+id+â€™â€);UI.closeModal()â€™);}

function showObjectiveModal(o){
var ed=o?true:false;o=o||{};
var html=â€™<form id="objForm"><div class="form-group"><label class="form-label">Objetivo *</label><input class="form-input" name="title" value="'+(o.title||'')+'" required></div><div class="form-row"><div class="form-group"><label class="form-label">Area</label><select class="form-select" name="area"><option value=â€œgrowthâ€ â€˜+(o.area===â€˜growthâ€™?â€˜selectedâ€™:â€™â€™)+â€™>Crecimiento</option><option value=â€œrevenueâ€ â€˜+(o.area===â€˜revenueâ€™?â€˜selectedâ€™:â€™â€™)+â€™>Ingresos</option><option value=â€œteamâ€ â€˜+(o.area===â€˜teamâ€™?â€˜selectedâ€™:â€™â€™)+â€™>Equipo</option></select></div><div class="form-group"><label class="form-label">Unidad</label><input class="form-input" name="unit" value="'+(o.unit||'')+'"></div></div><div class="form-row"><div class="form-group"><label class="form-label">Meta</label><input type="number" class="form-input" name="target" value="'+(o.target||'')+'"></div><div class="form-group"><label class="form-label">Actual</label><input type="number" class="form-input" name="current" value="'+(o.current||0)+'"></div></div><input type="hidden" name="id" value="'+(o.id||'')+'"></form>â€™;
var footer=(ed?â€™<button class="btn btn-danger" onclick="delObjective(\''+o.id+'\')">Eliminar</button>â€™:â€™â€™)+â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveObjective()">Guardar</button>â€™;
UI.modal(ed?â€˜Editar objetivoâ€™:â€˜Nuevo objetivoâ€™,html,footer);
}
function saveObjective(){var f=document.getElementById(â€˜objFormâ€™);var d=Object.fromEntries(new FormData(f));if(!d.title||!d.title.trim()){UI.toast(â€˜Titulo requeridoâ€™,â€˜errorâ€™);return;}d.target=parseInt(d.target)||0;d.current=parseInt(d.current)||0;if(d.id){DB.update(â€˜objectivesâ€™,d.id,d);UI.toast(â€˜Actualizadoâ€™);}else{delete d.id;DB.add(â€˜objectivesâ€™,d);UI.toast(â€˜Creadoâ€™);}UI.closeModal();render();}
function delObjective(id){UI.confirm(â€˜Eliminar objetivo?â€™,â€˜DB.del(â€œobjectivesâ€,â€â€™+id+â€™â€);UI.closeModal()â€™);}

function showDecisionModal(d){
var ed=d?true:false;d=d||{};
var html=â€™<form id="decForm"><div class="form-group"><label class="form-label">Decision *</label><input class="form-input" name="title" value="'+(d.title||'')+'" required></div><div class="form-group"><label class="form-label">Contexto</label><textarea class="form-textarea" name="context">â€™+(d.context||â€™â€™)+â€™</textarea></div><div class="form-row"><div class="form-group"><label class="form-label">Deadline</label><input type="date" class="form-input" name="deadline" value="'+(d.deadline||'')+'"></div><div class="form-group"><label class="form-label">Estado</label><select class="form-select" name="decided"><option value=â€œfalseâ€ â€˜+(!d.decided?â€˜selectedâ€™:â€™â€™)+â€™>Pendiente</option><option value=â€œtrueâ€ â€˜+(d.decided?â€˜selectedâ€™:â€™â€™)+â€™>Decidida</option></select></div></div><input type="hidden" name="id" value="'+(d.id||'')+'"></form>â€™;
var footer=(ed?â€™<button class="btn btn-danger" onclick="delDecision(\''+d.id+'\')">Eliminar</button>â€™:â€™â€™)+â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveDecision()">Guardar</button>â€™;
UI.modal(ed?â€˜Editar decisionâ€™:â€˜Nueva decisionâ€™,html,footer);
}
function saveDecision(){var f=document.getElementById(â€˜decFormâ€™);var d=Object.fromEntries(new FormData(f));if(!d.title||!d.title.trim()){UI.toast(â€˜Titulo requeridoâ€™,â€˜errorâ€™);return;}d.decided=d.decided===â€˜trueâ€™;if(d.id){DB.update(â€˜decisionsâ€™,d.id,d);UI.toast(â€˜Actualizadoâ€™);}else{delete d.id;DB.add(â€˜decisionsâ€™,d);UI.toast(â€˜Creadoâ€™);}UI.closeModal();render();}
function delDecision(id){UI.confirm(â€˜Eliminar decision?â€™,â€˜DB.del(â€œdecisionsâ€,â€â€™+id+â€™â€);UI.closeModal()â€™);}

function showOpportunityModal(o){
var ed=o?true:false;o=o||{};
var html=â€™<form id="oppForm"><div class="form-group"><label class="form-label">Titulo *</label><input class="form-input" name="title" value="'+(o.title||'')+'" required></div><div class="form-group"><label class="form-label">Descripcion</label><textarea class="form-textarea" name="desc">â€™+(o.desc||â€™â€™)+â€™</textarea></div><div class="form-row"><div class="form-group"><label class="form-label">Potencial</label><input type="number" class="form-input" name="potential" value="'+(o.potential||'')+'"></div><div class="form-group"><label class="form-label">Estado</label><select class="form-select" name="status"><option value=â€œideaâ€ â€˜+(o.status===â€˜ideaâ€™?â€˜selectedâ€™:â€™â€™)+â€™>Idea</option><option value=â€œexploringâ€ â€˜+(o.status===â€˜exploringâ€™?â€˜selectedâ€™:â€™â€™)+â€™>Explorando</option><option value=â€œlaunchedâ€ â€˜+(o.status===â€˜launchedâ€™?â€˜selectedâ€™:â€™â€™)+â€™>Lanzado</option></select></div></div><input type="hidden" name="id" value="'+(o.id||'')+'"></form>â€™;
var footer=(ed?â€™<button class="btn btn-danger" onclick="delOpportunity(\''+o.id+'\')">Eliminar</button>â€™:â€™â€™)+â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveOpportunity()">Guardar</button>â€™;
UI.modal(ed?â€˜Editar oportunidadâ€™:â€˜Nueva oportunidadâ€™,html,footer);
}
function saveOpportunity(){var f=document.getElementById(â€˜oppFormâ€™);var d=Object.fromEntries(new FormData(f));if(!d.title||!d.title.trim()){UI.toast(â€˜Titulo requeridoâ€™,â€˜errorâ€™);return;}d.potential=parseInt(d.potential)||0;if(d.id){DB.update(â€˜opportunitiesâ€™,d.id,d);UI.toast(â€˜Actualizadoâ€™);}else{delete d.id;DB.add(â€˜opportunitiesâ€™,d);UI.toast(â€˜Creadoâ€™);}UI.closeModal();render();}
function delOpportunity(id){UI.confirm(â€˜Eliminar oportunidad?â€™,â€˜DB.del(â€œopportunitiesâ€,â€â€™+id+â€™â€);UI.closeModal()â€™);}

function showProjectModal(p){
var ed=p?true:false;p=p||{};
var html=â€™<form id="projForm"><div class="form-group"><label class="form-label">Titulo *</label><input class="form-input" name="title" value="'+(p.title||'')+'" required></div><div class="form-group"><label class="form-label">Descripcion</label><textarea class="form-textarea" name="desc">â€™+(p.desc||â€™â€™)+â€™</textarea></div><div class="form-row"><div class="form-group"><label class="form-label">Progreso %</label><input type="number" class="form-input" name="progress" value="'+(p.progress||0)+'" min="0" max="100"></div><div class="form-group"><label class="form-label">Estado</label><select class="form-select" name="status"><option value=â€œactiveâ€ â€˜+(p.status===â€˜activeâ€™?â€˜selectedâ€™:â€™â€™)+â€™>Activo</option><option value=â€œpausedâ€ â€˜+(p.status===â€˜pausedâ€™?â€˜selectedâ€™:â€™â€™)+â€™>Pausado</option><option value=â€œdoneâ€ â€˜+(p.status===â€˜doneâ€™?â€˜selectedâ€™:â€™â€™)+â€™>Completado</option></select></div></div><input type="hidden" name="id" value="'+(p.id||'')+'"></form>â€™;
var footer=(ed?â€™<button class="btn btn-danger" onclick="delProject(\''+p.id+'\')">Eliminar</button>â€™:â€™â€™)+â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveProject()">Guardar</button>â€™;
UI.modal(ed?â€˜Editar proyectoâ€™:â€˜Nuevo proyectoâ€™,html,footer);
}
function saveProject(){var f=document.getElementById(â€˜projFormâ€™);var d=Object.fromEntries(new FormData(f));if(!d.title||!d.title.trim()){UI.toast(â€˜Titulo requeridoâ€™,â€˜errorâ€™);return;}d.progress=parseInt(d.progress)||0;if(d.id){DB.update(â€˜projectsâ€™,d.id,d);UI.toast(â€˜Actualizadoâ€™);}else{delete d.id;DB.add(â€˜projectsâ€™,d);UI.toast(â€˜Creadoâ€™);}UI.closeModal();render();}
function delProject(id){UI.confirm(â€˜Eliminar proyecto?â€™,â€˜DB.del(â€œprojectsâ€,â€â€™+id+â€™â€);UI.closeModal()â€™);}
function showSentimentModal(cid){
var c=DB.getClient(cid);
var html=â€™<div style="display:flex;justify-content:center;gap:20px;padding:20px">â€™;
SENTIMENTS.forEach(function(s){html+=â€™<div style="text-align:center;cursor:pointer" onclick="setSentiment(\''+cid+'\',\''+s.id+'\')"><div style="font-size:48px;'+(c.sentiment===s.id?'':'opacity:.4')+'">â€™+s.emoji+â€™</div><div style="font-size:12px;margin-top:8px">â€™+s.label+â€™</div></div>â€™;});
html+=â€™</div>â€™;
UI.modal(â€˜Sentimientoâ€™,html,â€™â€™);
}
function setSentiment(cid,s){DB.update(â€˜clientsâ€™,cid,{sentiment:s});UI.closeModal();render();UI.toast(â€˜Actualizadoâ€™);}

function showActionModal(cid){
var html=â€™<form id="actionForm"><div class="form-group"><label class="form-label">Accion *</label><input class="form-input" name="text" required></div><div class="form-group"><label class="form-label">Fecha</label><input type="date" class="form-input" name="date" value="'+U.today()+'"></div><input type="hidden" name="clientId" value="'+cid+'"></form>â€™;
UI.modal(â€˜Nueva accionâ€™,html,â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveAction()">Guardar</button>â€™);
}
function saveAction(){var f=document.getElementById(â€˜actionFormâ€™);var d=Object.fromEntries(new FormData(f));if(!d.text||!d.text.trim()){UI.toast(â€˜Texto requeridoâ€™,â€˜errorâ€™);return;}if(!DB.data.actions)DB.data.actions=[];DB.data.actions.push({id:â€˜actâ€™+Date.now(),text:d.text,date:d.date,clientId:d.clientId});DB.save();UI.closeModal();render();UI.toast(â€˜Accion guardadaâ€™);}

function editClientNotes(id){
var c=DB.getClient(id);
var html=â€™<textarea id="notesText" class="form-textarea" style="min-height:150px">â€™+(c.notes||â€™â€™)+â€™</textarea>â€™;
UI.modal(â€˜Notasâ€™,html,â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveClientNotes(\''+id+'\')">Guardar</button>â€™);
}
function saveClientNotes(id){var notes=document.getElementById(â€˜notesTextâ€™).value;DB.update(â€˜clientsâ€™,id,{notes:notes});UI.closeModal();render();UI.toast(â€˜Guardadoâ€™);}

function showCalActionModal(aid){
var html=â€™<form id="calForm"><div class="form-row"><div class="form-group"><label class="form-label">Tipo</label><select class="form-select" name="type"><option value="revision">Revision</option><option value="report">Informe</option><option value="optimization">Optimizacion</option><option value="meeting">Reunion</option></select></div><div class="form-group"><label class="form-label">Frecuencia</label><select class="form-select" name="frequency"><option value="daily">Diario</option><option value="weekly">Semanal</option><option value="biweekly">Quincenal</option><option value="monthly">Mensual</option></select></div></div><div class="form-group"><label class="form-label">Dia (1-31)</label><input type="number" class="form-input" name="day" value="1" min="1" max="31"></div><input type="hidden" name="aid" value="'+aid+'"></form>â€™;
UI.modal(â€˜Accion calendarioâ€™,html,â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveCalAction()">Guardar</button>â€™);
}
function saveCalAction(){var f=document.getElementById(â€˜calFormâ€™);var d=Object.fromEntries(new FormData(f));var a=DB.get(â€˜accountsâ€™,d.aid);if(a){if(!a.calendarActions)a.calendarActions=[];a.calendarActions.push({id:â€˜caâ€™+Date.now(),type:d.type,frequency:d.frequency,day:parseInt(d.day)||1});DB.update(â€˜accountsâ€™,d.aid,{calendarActions:a.calendarActions});UI.closeModal();render();UI.toast(â€˜Guardadoâ€™);}}
function delCalAction(aid,cid){var a=DB.get(â€˜accountsâ€™,aid);if(a){a.calendarActions=(a.calendarActions||[]).filter(function(c){return c.id!==cid;});DB.update(â€˜accountsâ€™,aid,{calendarActions:a.calendarActions});render();UI.toast(â€˜Eliminadoâ€™);}}

function showCommissionModal(aid){
var mgrOpts=â€™â€™;DB.data.managers.forEach(function(m){mgrOpts+=â€™<option value="'+m.id+'">â€™+m.name+â€™</option>â€™;});
var html=â€™<form id="commForm"><div class="form-row"><div class="form-group"><label class="form-label">Tipo</label><select class="form-select" name="type" onchange="updateCommPerson(this.value)"><option value="manager">Manager</option><option value="comercial">Comercial</option><option value="referrer">Referidor</option></select></div><div class="form-group"><label class="form-label">Persona</label><select class="form-select" name="personId" id="commPersonSel">â€™+mgrOpts+â€™</select></div></div><div class="form-group"><label class="form-label">Porcentaje %</label><input type="number" class="form-input" name="percent" value="5"></div><input type="hidden" name="aid" value="'+aid+'"></form>â€™;
UI.modal(â€˜Comisionâ€™,html,â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveCommission()">Guardar</button>â€™);
}
function updateCommPerson(t){var s=document.getElementById(â€˜commPersonSelâ€™);var opts=â€™â€™;if(t===â€˜comercialâ€™){DB.data.comerciales.forEach(function(c){opts+=â€™<option value="'+c.id+'">â€™+c.name+â€™</option>â€™;});}else if(t===â€˜referrerâ€™){DB.data.referrers.forEach(function(r){opts+=â€™<option value="'+r.id+'">â€™+r.name+â€™</option>â€™;});}else{DB.data.managers.forEach(function(m){opts+=â€™<option value="'+m.id+'">â€™+m.name+â€™</option>â€™;});}s.innerHTML=opts;}
function saveCommission(){var f=document.getElementById(â€˜commFormâ€™);var d=Object.fromEntries(new FormData(f));var a=DB.get(â€˜accountsâ€™,d.aid);if(a){if(!a.commissions)a.commissions=[];a.commissions.push({type:d.type,personId:d.personId,percent:parseInt(d.percent)||5});DB.update(â€˜accountsâ€™,d.aid,{commissions:a.commissions});UI.closeModal();render();UI.toast(â€˜Guardadoâ€™);}}
function delCommission(aid,pid){var a=DB.get(â€˜accountsâ€™,aid);if(a){a.commissions=(a.commissions||[]).filter(function(c){return c.personId!==pid;});DB.update(â€˜accountsâ€™,aid,{commissions:a.commissions});render();UI.toast(â€˜Eliminadoâ€™);}}

function showMetricModal(aid){
var html=â€™<form id="metForm"><div class="form-group"><label class="form-label">Mes</label><input type="month" class="form-input" name="month" value="'+new Date().toISOString().slice(0,7)+'"></div><div class="form-row"><div class="form-group"><label class="form-label">Leads</label><input type="number" class="form-input" name="leads" value="0"></div><div class="form-group"><label class="form-label">CPL</label><input type="number" class="form-input" name="cpl" value="0"></div></div><div class="form-group"><label class="form-label">Inversion</label><input type="number" class="form-input" name="investment" value="0"></div><input type="hidden" name="aid" value="'+aid+'"></form>â€™;
UI.modal(â€˜Metrica mensualâ€™,html,â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveMetric()">Guardar</button>â€™);
}
function saveMetric(){var f=document.getElementById(â€˜metFormâ€™);var d=Object.fromEntries(new FormData(f));var a=DB.get(â€˜accountsâ€™,d.aid);if(a){if(!a.metrics)a.metrics=[];a.metrics.unshift({month:d.month,leads:parseInt(d.leads)||0,cpl:parseInt(d.cpl)||0,investment:parseInt(d.investment)||0});DB.update(â€˜accountsâ€™,d.aid,{metrics:a.metrics});UI.closeModal();render();UI.toast(â€˜Guardadoâ€™);}}

function showScenarioModal(){
var sc=DB.data.scenario;
var html=â€™<form id="scForm"><div class="form-group"><label class="form-label">Nuevas cuentas/mes</label><input type="number" class="form-input" name="newAccMonth" value="'+sc.newAccMonth+'"></div><div class="form-group"><label class="form-label">Churn % mensual</label><input type="number" class="form-input" name="churn" value="'+sc.churn+'"></div><div class="form-group"><label class="form-label">Fee medio</label><input type="number" class="form-input" name="avgFee" value="'+sc.avgFee+'"></div></form>â€™;
UI.modal(â€˜Escenario proyeccionâ€™,html,â€™<button class="btn btn-secondary" onclick="UI.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="saveScenario()">Guardar</button>â€™);
}
function saveScenario(){var f=document.getElementById(â€˜scFormâ€™);var d=Object.fromEntries(new FormData(f));DB.data.scenario={newAccMonth:parseInt(d.newAccMonth)||5,churn:parseInt(d.churn)||3,avgFee:parseInt(d.avgFee)||350};DB.save();UI.closeModal();render();UI.toast(â€˜Guardadoâ€™);}

function toggleMenu(){document.getElementById(â€˜sidebarâ€™).classList.toggle(â€˜openâ€™);document.getElementById(â€˜overlayâ€™).classList.toggle(â€˜activeâ€™);}
function closeMenu(){document.getElementById(â€˜sidebarâ€™).classList.remove(â€˜openâ€™);document.getElementById(â€˜overlayâ€™).classList.remove(â€˜activeâ€™);}
function navM(p){closeMenu();nav(p);}

function init(){
DB.init();
var appHtml=â€™<div class="app">â€™;
appHtml+=â€™<div class="overlay" id="overlay" onclick="closeMenu()"></div>â€™;
appHtml+=â€™<div class="mobile-header"><button class="menu-btn" onclick="toggleMenu()">â˜°</button><span style="flex:1;font-weight:600">Sowper</span><button class="btn btn-primary btn-sm" onclick="showAccountModal()">+</button></div>â€™;
appHtml+=â€™<aside class="sidebar" id="sidebar"><div class="sidebar-header"><div class="logo">S</div><div class="brand">â€™+DB.data.company.name+â€™<span>Command Center</span></div></div>â€™;
appHtml+=â€™<nav class="nav">â€™;
appHtml+=â€™<div class="nav-section"><div class="nav-label">General</div><div class="nav-item active" data-page="dashboard" onclick="navM(\'dashboard\')">Dashboard</div><div class="nav-item" data-page="clients" onclick="navM(\'clients\')">Clientes</div><div class="nav-item" data-page="accounts" onclick="navM(\'accounts\')">Cuentas</div></div>â€™;
appHtml+=â€™<div class="nav-section"><div class="nav-label">Comercial</div><div class="nav-item" data-page="pipeline" onclick="navM(\'pipeline\')">Pipeline <span class="nav-badge" id="leadsBadge">0</span></div><div class="nav-item" data-page="comerciales" onclick="navM(\'comerciales\')">Comerciales</div><div class="nav-item" data-page="referrers" onclick="navM(\'referrers\')">Referidores</div></div>â€™;
appHtml+=â€™<div class="nav-section"><div class="nav-label">Equipo</div><div class="nav-item" data-page="managers" onclick="navM(\'managers\')">Managers</div><div class="nav-item" data-page="tasks" onclick="navM(\'tasks\')">Tareas <span class="nav-badge" id="taskBadge">0</span></div></div>â€™;
appHtml+=â€™<div class="nav-section"><div class="nav-label">Finanzas</div><div class="nav-item" data-page="finance" onclick="navM(\'finance\')">Finanzas</div><div class="nav-item" data-page="objectives" onclick="navM(\'objectives\')">Objetivos</div></div>â€™;
appHtml+=â€™<div class="nav-section"><div class="nav-label">Estrategia</div><div class="nav-item" data-page="inbox" onclick="navM(\'inbox\')">Inbox <span class="nav-badge" id="inboxBadge">0</span></div><div class="nav-item" data-page="decisions" onclick="navM(\'decisions\')">Decisiones <span class="nav-badge" id="decBadge">0</span></div><div class="nav-item" data-page="opportunities" onclick="navM(\'opportunities\')">Oportunidades</div><div class="nav-item" data-page="projects" onclick="navM(\'projects\')">Proyectos</div></div>â€™;
appHtml+=â€™<div class="nav-section"><div class="nav-label">Sistema</div><div class="nav-item" data-page="settings" onclick="navM(\'settings\')">Config</div></div>â€™;
appHtml+=â€™</nav></aside>â€™;
appHtml+=â€™<main class="main"><header class="header"><h2 class="page-title" id="pageTitle">Dashboard</h2></header><div class="content" id="pageContent"></div></main></div>â€™;
appHtml+=â€™<div id="modals"></div><div class="toast-box" id="toasts"></div>â€™;
document.getElementById(â€˜appâ€™).innerHTML=appHtml;
render();
}
init();
</script></body></html>
